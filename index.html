<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Créateur de CV IA - Pro Recruteur</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&family=Montserrat:wght@400;500;700;800&family=Playfair+Display:ital,wght@0,400..900;1,400..900&family=Roboto+Mono:wght@400;700&family=Merriweather:wght@400;700&family=Oswald:wght@400;700&family=Cormorant+Garamond:wght@400;700&family=Open+Sans:wght@400;700&family=Source+Sans+Pro:wght@400;700&family=Nunito+Sans:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    
    <style>
        :root {
            --page-margin: 2cm;
            --primary-color: #2563eb;
            --secondary-color: #334155;
            --body-text-color: #334155;
            --font-family-h1: 'Montserrat', sans-serif;
            --font-family-h2: 'Montserrat', sans-serif;
            --font-family-body: 'Lato', sans-serif;
            --font-size-h1: 40pt;
            --font-size-h2: 21pt;
            --font-size-p: 10pt;
            --font-size-banner: 9pt;
            --line-height: 1.6;
            --paragraph-spacing: 0.5rem;
            --module-spacing: 1.5rem;
            --item-spacing: 0.5rem;
            --banner-element-spacing: 1rem;
        }

        #cv-preview-wrapper { width: 100%; display: flex; flex-direction: column; align-items: center; gap: 20px; }
        .a4-page-container { position: relative; }
        /* CORRECTIF : Remplacement de min-height par height pour une détection de dépassement fiable */
        .a4-page { width: 21cm; height: 29.7cm; box-shadow: 0 10px 30px rgba(0,0,0,0.15); background-color: white; overflow: hidden; display: flex; flex-direction: column; transition: all 0.3s ease; font-family: var(--font-family-body); color: var(--body-text-color); position: relative; outline: 2px solid transparent; outline-offset: -2px; padding: var(--page-margin); box-sizing: border-box; }
        body.overflow-check-active .is-overflowing { outline: 3px solid #ef4444 !important; box-shadow: 0 0 20px 8px rgba(239, 68, 68, 0.3) !important; }
        
        .remove-page-btn { position: absolute; top: -10px; right: -10px; width: 30px; height: 30px; background-color: #ef4444; color: white; border: none; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; opacity: 0.5; transition: opacity 0.2s, transform 0.2s; z-index: 10; }
        .remove-page-btn:hover { opacity: 1; transform: scale(1.1); }
        .a4-page-container:first-child .remove-page-btn { display: none; }

        #add-page-btn-wrapper { width: 21cm; text-align: center; padding: 10px 0; }
        #add-page-btn { width: 50px; height: 50px; background-color: #3b82f6; color: white; border-radius: 50%; border: none; cursor: pointer; font-size: 24px; transition: transform 0.2s; }
        #add-page-btn:hover { transform: scale(1.1); }

        .cv-body-container { display: grid; gap: 1rem; height: 100%; flex-grow: 1; position: relative; }
        .layout-1-col { grid-template-columns: 1fr; }
        .layout-2-col-33-67 { grid-template-columns: 1fr 2fr; }
        .layout-2-col-50-50 { grid-template-columns: 1fr 1fr; }
        .layout-2-col-67-33 { grid-template-columns: 2fr 1fr; }

        .cv-column { min-height: 150px; height: 100%; border: 1px dotted #ccc; padding: 5px; }
        .cv-module { position: relative; margin-bottom: var(--module-spacing); }
        .cv-module .drag-handle { position: absolute; top: 10px; left: -25px; cursor: grab; color: #d1d5db; opacity: 0; transition: opacity 0.2s; font-size: 1.2rem; }
        .cv-module:hover .drag-handle { opacity: 1; }
        .sortable-ghost { opacity: 0.4; background: #cce7ff; border: 1px dashed var(--primary-color); }

        [contenteditable="true"]:hover { outline: 1px dashed #3b82f6; background-color: #eff6ff; }
        [contenteditable="true"]:focus { outline: 2px solid #3b82f6; background-color: #dbeafe; }

        .cv-header h1 { font-family: var(--font-family-h1); font-weight: 800; font-size: var(--font-size-h1); color: var(--primary-color); margin-bottom: 0.25rem; }
        .cv-header p { font-family: var(--font-family-body); font-size: 1.2rem; color: var(--secondary-color); }
        .section-title { font-family: var(--font-family-h2); font-weight: 700; font-size: var(--font-size-h2); margin-bottom: 0.8rem; padding-bottom: 0.4rem; color: var(--primary-color); display: flex; align-items: center; gap: 0.5rem; transition: opacity 0.3s; }
        .section-title.style-underline { border-bottom: 2px solid var(--primary-color); }
        .section-title.style-side-line { border-left: 4px solid var(--primary-color); border-bottom: none; padding-left: 0.5rem; }
        .section-title.style-background { background-color: var(--primary-color); color: white; padding: 0.3rem 0.6rem; margin-bottom: 1rem; border-radius: 0.25rem; }
        .section-title.style-background .section-icon { color: white !important; }
        .section-title.style-boxed { border: 2px solid var(--primary-color); padding: 0.3rem 0.6rem; }

        .section-title .section-icon { cursor: pointer; transition: transform 0.2s; }
        .section-title .section-icon:hover { transform: scale(1.1); }
        .a4-page p, .a4-page li, #cv-description-preview, #cv-experience-preview, #cv-formation-preview { font-size: var(--font-size-p); line-height: var(--line-height); }
        .a4-page p { margin-bottom: var(--paragraph-spacing); }
        .a4-page ul { list-style: none; padding-left: 0;}
        #cv-competences-preview[data-style="simple"] ul li,
        .a4-page ul li { padding-left: 1.4em; position: relative; margin-bottom: 0.25rem; }
        #cv-competences-preview[data-style="simple"] ul li::before,
        .a4-page ul li::before { content: '›'; font-weight: bold; position: absolute; left: 0; color: var(--primary-color); font-size: 1.2em; top: -0.1em; }
        
        .item-title { font-weight: 700; color: var(--secondary-color); }
        .item-meta { font-size: calc(var(--font-size-p) * 0.9); font-style: italic; }

        #recruiter-banner { display: flex; align-items: center; padding: 0.5rem; box-sizing: border-box; width: 100%; font-size: var(--font-size-banner); position: relative; overflow: hidden; }
        .banner-content-wrapper { position: relative; z-index: 1; display: flex; align-items: center; width: 100%; height: 100%; gap: var(--banner-element-spacing); }
        #banner-bg-img-preview { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; z-index: 0; transition: opacity 0.3s, filter 0.3s; }
        #fixed-banner-top { margin-bottom: var(--module-spacing); display: none; }
        #fixed-banner-bottom { margin-top: auto; padding-top: var(--module-spacing); display: none; }
        #banner-img-preview { border-radius: 50%; object-fit: cover; flex-shrink: 0; transition: width 0.3s, height 0.3s; background-color: rgba(255,255,255,0.5); }
        #banner-img-preview.logo-sm { width: 40px; height: 40px; }
        #banner-img-preview.logo-md { width: 60px; height: 60px; }
        #banner-img-preview.logo-lg { width: 80px; height: 80px; }
        #banner-img-preview.logo-xl { width: 100px; height: 100px; }
        #banner-img-preview.logo-xxl { width: 120px; height: 120px; }
        #banner-nom-preview { font-weight: 700; }
        .banner-align-left { justify-content: flex-start; text-align: left; }
        .banner-align-center { justify-content: center; text-align: center; }
        .banner-align-right { justify-content: flex-end; text-align: right; }
        .banner-layout-inverted { flex-direction: row-reverse; }
        .banner-style-elegant { border-top: 2px solid var(--primary-color); border-bottom: 2px solid var(--primary-color); background: transparent; }
        .banner-style-modern { background-color: var(--primary-color); color: white; border-radius: 0.5rem; }
        .banner-style-modern p, .banner-style-modern span { color: white !important; }
        .banner-style-discret { border-left: 4px solid #d1d5db; background: transparent; }
        .banner-style-carte { box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1); border-radius: 0.5rem; background: #f9fafb; }
        .banner-style-degrade { background: linear-gradient(to right, var(--primary-color), #a5b4fc); color: white; border-radius: 0.5rem; }
        .banner-style-degrade p, .banner-style-degrade span { color: white !important; }
        .banner-style-premium { background-color: #1e293b; color: #fde68a; border: 1px solid #fde68a; border-radius: 0.25rem; }
        .banner-style-premium p, .banner-style-premium span { color: #f1f5f9 !important; }
        .banner-style-minimal { border-bottom: 2px solid var(--primary-color); }
        .banner-style-encadre { border: 2px solid var(--primary-color); border-radius: 0.5rem; }
        .banner-style-ligne-haute { border-top: 4px solid var(--primary-color); padding-top: 0.8rem !important; }

        /* Toolbar Styles */
        #top-toolbar {
            position: sticky;
            top: 0;
            z-index: 1000;
            backdrop-filter: blur(10px);
            background-color: rgba(255, 255, 255, 0.95);
        }
        .toolbar-btn {
            white-space: nowrap;
            transition: all 0.2s ease;
        }
        .toolbar-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .toolbar-btn:active {
            transform: translateY(0);
        }

        /* Accessibility Styles */
        .accessibility-high-contrast {
            filter: contrast(1.5);
        }
        .accessibility-high-contrast body {
            background-color: #000 !important;
            color: #fff !important;
        }
        .accessibility-high-contrast .a4-page {
            background-color: #000 !important;
            color: #fff !important;
            border: 2px solid #fff !important;
        }
        .accessibility-high-contrast [contenteditable="true"]:hover {
            background-color: #333 !important;
            outline: 1px solid #fff !important;
        }
        .accessibility-high-contrast [contenteditable="true"]:focus {
            background-color: #444 !important;
            outline: 2px solid #fff !important;
        }

        .accessibility-large-text {
            font-size: 1.2em !important;
        }
        .accessibility-large-text .a4-page p,
        .accessibility-large-text .a4-page li {
            font-size: 1.4rem !important;
        }
        .accessibility-large-text .cv-header h1 {
            font-size: 3rem !important;
        }
        .accessibility-large-text .section-title {
            font-size: 1.4rem !important;
        }

        .accessibility-keyboard-nav .cv-module:focus-within {
            outline: 3px solid #4f46e5 !important;
            outline-offset: 2px;
        }
        .accessibility-keyboard-nav [contenteditable="true"]:focus {
            outline: 3px solid #4f46e5 !important;
            outline-offset: 2px;
        }

        .accessibility-focus-visible *:focus {
            outline: 2px solid #4f46e5 !important;
            outline-offset: 2px;
        }

        .accessibility-reduced-motion * {
            animation-duration: 0.01ms !important;
            animation-iteration-count: 1 !important;
            transition-duration: 0.01ms !important;
        }

        .accessibility-no-animations * {
            animation: none !important;
            transition: none !important;
        }

        .accessibility-large-targets button,
        .accessibility-large-targets .toolbar-btn {
            min-width: 44px;
            min-height: 44px;
        }

        .accessibility-skip-links {
            position: absolute;
            top: -40px;
            left: 6px;
            background: #000;
            color: #fff;
            padding: 8px;
            text-decoration: none;
            z-index: 1000;
            border-radius: 4px;
        }
        .accessibility-skip-links:focus {
            top: 6px;
        }

        #notification { position: fixed; top: 20px; right: 20px; z-index: 10000; }

        /* Zoom Controller Styles */
        #zoom-controller {
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            backdrop-filter: blur(10px);
            background-color: rgba(255, 255, 255, 0.95);
        }
        #zoom-controller button {
            transition: all 0.2s ease;
        }
        #zoom-controller button:hover {
            background-color: #e5e7eb;
        }
        #zoom-controller input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            background: #e5e7eb;
            height: 4px;
            border-radius: 2px;
        }
        #zoom-controller input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #3b82f6;
            cursor: pointer;
        }
        #zoom-controller input[type="range"]::-moz-range-thumb {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #3b82f6;
            cursor: pointer;
            border: none;
        }

        /* API Status Indicator */
        #api-status-indicator {
            transition: background-color 0.3s ease;
        }

        /* Template Items */
        .template-item {
            transition: all 0.2s ease;
        }
        .template-item:hover {
            background-color: #f3f4f6;
        }
        .template-item button {
            transition: all 0.2s ease;
        }
        .template-item .load-template-btn:hover {
            background-color: #2563eb;
        }
        .template-item .delete-template-btn:hover {
            background-color: #dc2626;
        }
        .toast { background-color: white; color: #111827; padding: 1rem 1.5rem; border-radius: 0.5rem; box-shadow: 0 5px 15px rgba(0,0,0,0.1); display: flex; align-items: center; gap: 0.75rem; transition: all 0.3s ease; transform: translateX(120%); }
        .toast.show { transform: translateX(0); }

        /* Styles for collapsible control panel sections */
        details.control-group {
            background-color: #f9fafb;
            border: 1px solid #f3f4f6;
            border-radius: 0.5rem;
            transition: background-color 0.2s;
        }
        details.control-group[open] {
            background-color: white;
            border-color: #e5e7eb;
        }
        details.control-group summary {
            list-style: none;
            cursor: pointer;
            padding: 1rem;
            font-weight: 600;
            color: #374151;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        details.control-group summary::-webkit-details-marker {
            display: none;
        }
        details.control-group .control-group-content {
            padding: 0 1rem 1rem 1rem;
            border-top: 1px solid #f3f4f6;
            margin-top: -0.5rem;
            padding-top: 1rem;
        }
        .completion-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.75rem;
            font-weight: 400;
            color: #6b7280;
            cursor: pointer;
        }
        .completion-checkbox {
            height: 1rem;
            width: 1rem;
            border-radius: 0.25rem;
            border-color: #d1d5db;
            color: #4f46e5;
            cursor: pointer;
        }
        .completion-checkbox:focus {
            outline: 2px solid #4f46e5;
        }
        
        #ai-summarize-btn { background-color: #9333ea; color: white; border: none; cursor: pointer; transition: all 0.2s ease-in-out; }
        #ai-summarize-btn:hover { background-color: #7c3aed; transform: translateY(-1px); box-shadow: 0 4px 8px rgba(147, 51, 234, 0.3); }

        /* --- Specific styles for skills section --- */
        #cv-competences-preview h3.skill-category { font-family: var(--font-family-h2); font-weight: 700; color: var(--secondary-color); margin-top: 0.8rem; margin-bottom: 0.4rem; padding-bottom: 0.2rem; border-bottom: 1px solid #e5e7eb; font-size: calc(var(--font-size-p) * 1.05); text-transform: uppercase; letter-spacing: 0.5px; }
        #cv-competences-preview .skill-category:hover { background-color: #f3f4f6; }
        #cv-competences-preview[data-style="tags"] ul { padding-left: 0; list-style: none; margin-top: 0.25rem; margin-bottom: 0.5rem; line-height: 1.5; }
        #cv-competences-preview[data-style="tags"] ul li.skill-item { display: inline-block; margin: 0 8px 6px 0; padding: 3px 20px 3px 10px; border-radius: 12px; background-color: #f3f4f6; font-size: calc(var(--font-size-p) * 0.95); position: relative; cursor: grab; }
        #cv-competences-preview[data-style="tags"] ul li.skill-item:hover { background-color: #e5e7eb; }
        #cv-competences-preview[data-style="tags"] ul li::before { content: none; }
        .skills-ghost { opacity: 0.4; background: #cce7ff; border-radius: 12px; }
        .skill-item .delete-skill-btn { display: none; position: absolute; top: 50%; right: 5px; transform: translateY(-50%); cursor: pointer; font-size: 14px; line-height: 1; color: #9ca3af; padding: 2px; }
        .skill-item:hover .delete-skill-btn { display: inline-block; }
        .skill-item .delete-skill-btn:hover { color: #ef4444; }
        .style-toggle-btn.active, .skill-style-btn.active, .section-title-style-btn.active, .layout-btn.active, .banner-align-btn.active, .logo-size-btn.active, .theme-btn.active, #banner-invert-btn.active, .gauge-style-btn.active, #toggle-overflow-btn.active { background-color: #3b82f6; color: white; }
        .skill-level { display: flex; align-items: center; margin-bottom: 6px; gap: 8px; }
        .skill-level-label { width: 120px; flex-shrink: 0; font-size: var(--font-size-p); }
        
        /* Gauge Styles */
        .gauge-container { flex-grow: 1; }
        .gauge-bar-bg { background-color: #e5e7eb; border-radius: 4px; height: 8px; overflow: hidden;}
        .gauge-bar-fill { background-color: var(--primary-color); height: 100%; border-radius: 4px; transition: width 0.3s ease; }
        .gauge-dots, .gauge-stars, .gauge-squares { display: flex; gap: 4px; font-size: 1.2em; color: #d1d5db; }
        .gauge-dots .filled, .gauge-stars .filled, .gauge-squares .filled { color: var(--primary-color); }
        .gauge-number { font-weight: bold; color: var(--secondary-color); }

        .editable-wrapper { position: relative; }
        .editable-wrapper .delete-line-btn { display: none; position: absolute; top: 50%; right: 2px; transform: translateY(-50%); cursor: pointer; color: #ef4444; background-color: white; border-radius: 50%; width: 18px; height: 18px; text-align: center; line-height: 18px; font-size: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); z-index: 5; }
        .editable-wrapper:hover .delete-line-btn { display: flex; align-items: center; justify-content: center; }
        .history-btn:disabled { opacity: 0.4; cursor: not-allowed; }
        .insert-line-wrapper { position: relative; height: 0.5rem; opacity: 0; transition: opacity 0.2s; margin: 0; display: flex; justify-content: center; align-items: center; }
        .dynamic-item-container:hover .insert-line-wrapper { opacity: 1; }
        .add-line-preview-btn { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background-color: #eef2ff; color: #4f46e5; border: 1px dashed #a5b4fc; width: 24px; height: 24px; border-radius: 50%; cursor: pointer; z-index: 5; display: flex; align-items: center; justify-content: center; font-size: 12px; transition: all 0.2s; }
        .add-line-preview-btn:hover { background: #c7d2fe; border-style: solid; transform: translate(-50%, -50%) scale(1.1); }
        
        .add-desc-line-btn { display: none; font-size: 0.8rem; color: #4f46e5; cursor: pointer; margin-top: 0.25rem; padding: 2px 4px; border-radius: 4px; background: transparent; border: none; }
        .add-desc-line-btn:hover { background-color: #eef2ff; }
        .dynamic-preview-item:hover .add-desc-line-btn { display: inline-block; }

        .dynamic-preview-item { position: relative; border: 1px solid transparent; border-radius: 0.375rem; padding: 0.5rem; margin-bottom: var(--item-spacing); transition: border-color 0.2s, background-color 0.2s, opacity 0.3s; }
        .dynamic-preview-item:hover { background-color: #fafafa; border-color: #e5e7eb; }

        .delete-block-btn { display: none; position: absolute; top: 4px; right: 4px; width: 24px; height: 24px; background-color: #fee2e2; color: #b91c1c; border: none; border-radius: 50%; cursor: pointer; align-items: center; justify-content: center; z-index: 6; }
        .dynamic-preview-item:hover .delete-block-btn { display: flex; }
        .delete-block-btn:hover { background-color: #fecaca; color: #991b1b; }
        .new-badge { background-color: #ef4444; color: white; font-size: 0.6rem; font-weight: bold; padding: 2px 5px; border-radius: 4px; margin-left: 6px; vertical-align: middle; }
        
        /* Modal Styles */
        .modal-overlay { position: fixed; inset: 0; background-color: rgba(0, 0, 0, 0.5); display: flex; align-items: center; justify-content: center; z-index: 5000; opacity: 0; transition: opacity 0.2s; pointer-events: none; }
        .modal-overlay.active { opacity: 1; pointer-events: auto; }
        .modal-content { background: white; padding: 2rem; border-radius: 0.5rem; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 90%; max-width: 500px; transform: scale(0.95); transition: transform 0.2s; }
        .modal-overlay.active .modal-content { transform: scale(1); }
        
        /* Icon Picker Modal */
        #icon-picker-modal .modal-content { max-width: 700px; }
        #icon-picker-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(50px, 1fr)); gap: 0.5rem; max-height: 60vh; overflow-y: auto; }
        #icon-picker-grid i { font-size: 1.5rem; padding: 0.75rem; border-radius: 0.25rem; cursor: pointer; text-align: center; transition: background-color 0.2s, color 0.2s; }
        #icon-picker-grid i:hover { background-color: #eef2ff; color: #4f46e5; }
        
        /* In-Preview AI Buttons */
        .section-ai-actions { margin-left: auto; display: flex; gap: 0.5rem; opacity: 0; transition: opacity 0.2s; }
        .cv-module:hover .section-ai-actions { opacity: 1; }
        .ai-action-btn { background: #e0e7ff; color: #4338ca; border: none; border-radius: 50%; width: 28px; height: 28px; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 0.8rem; }
        .ai-action-btn:hover { background: #c7d2fe; }

        /* Styles for hiding sections */
        .cv-module.section-hidden > *:not(h2) {
            display: none;
        }
        .cv-module.section-hidden > h2 {
            opacity: 0.5;
        }

        /* === NOUVEAUX STYLES POUR LA SECTION CONTENU ÉTENDUE === */

        /* Styles pour la photo de profil */
        #profile-photo-preview {
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid #e5e7eb;
            transition: border-color 0.2s;
        }
        #profile-photo-preview:hover {
            border-color: var(--primary-color);
        }

        /* Styles pour les nouvelles sections */
        .language-item, .project-item, .certification-item, .reference-item {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 0.75rem;
            position: relative;
        }

        .language-item:hover, .project-item:hover, .certification-item:hover, .reference-item:hover {
            background: #f3f4f6;
            border-color: #d1d5db;
        }

        /* Styles pour les niveaux de langue */
        .language-level {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.25rem 0.5rem;
            background: #e0e7ff;
            color: #4338ca;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .language-level.expert { background: #10b981; color: white; }
        .language-level.advanced { background: #3b82f6; color: white; }
        .language-level.intermediate { background: #f59e0b; color: white; }
        .language-level.beginner { background: #ef4444; color: white; }

        /* Styles pour les tags de centres d'intérêt */
        .interest-tag {
            display: inline-block;
            background: #f3f4f6;
            color: #374151;
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            margin: 0.25rem;
            font-size: 0.875rem;
            border: 1px solid #e5e7eb;
        }

        .interest-tag:hover {
            background: #e5e7eb;
        }

        /* Styles pour les boutons d'action étendus */
        .action-btn-extended {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s;
            border: none;
            cursor: pointer;
        }

        .action-btn-extended:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .action-btn-extended.primary {
            background: #3b82f6;
            color: white;
        }

        .action-btn-extended.primary:hover {
            background: #2563eb;
        }

        .action-btn-extended.secondary {
            background: #f3f4f6;
            color: #374151;
        }

        .action-btn-extended.secondary:hover {
            background: #e5e7eb;
        }

        /* Styles pour les compteurs */
        .counter-display {
            font-size: 0.75rem;
            color: #6b7280;
            font-weight: 500;
        }

        /* Styles pour les options d'affichage */
        .display-options {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .display-options h5 {
            margin-bottom: 0.75rem;
            font-weight: 600;
            color: #374151;
        }

        .display-options .option-group {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
        }

        .display-options label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            color: #374151;
            cursor: pointer;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            transition: background-color 0.2s;
        }

        .display-options label:hover {
            background: #f3f4f6;
        }

        /* Styles pour les sections sociales */
        .social-link-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .social-link-item .platform-icon {
            width: 32px;
            height: 32px;
            border-radius: 0.375rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            color: white;
        }

        .social-link-item .platform-info {
            flex-grow: 1;
        }

        .social-link-item .platform-name {
            font-weight: 500;
            color: #374151;
        }

        .social-link-item .platform-url {
            font-size: 0.875rem;
            color: #6b7280;
        }

        /* Styles pour les certifications */
        .certification-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            font-weight: 500;
            margin: 0.25rem;
        }

        .certification-badge .cert-icon {
            font-size: 1rem;
        }

        /* Styles pour les projets */
        .project-tech-stack {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .project-tech-tag {
            background: #e0e7ff;
            color: #4338ca;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: 500;
        }

        /* Styles pour les références */
        .reference-card {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 0.75rem;
        }

        .reference-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.75rem;
        }

        .reference-info h4 {
            margin: 0;
            color: #374151;
            font-weight: 600;
        }

        .reference-company {
            color: #6b7280;
            font-size: 0.875rem;
        }

        /* Styles pour les sections personnalisées étendues */
        .custom-section-extended {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }

        .custom-section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid #e5e7eb;
        }

        .custom-section-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: #374151;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .custom-section-actions {
            display: flex;
            gap: 0.5rem;
        }

        /* Styles pour les suggestions de sections */
        .section-suggestion-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .section-suggestion-item:hover {
            background: #f3f4f6;
            border-color: #d1d5db;
            transform: translateY(-1px);
        }

        .section-suggestion-icon {
            width: 40px;
            height: 40px;
            background: var(--primary-color);
            color: white;
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
        }

        .section-suggestion-info h4 {
            margin: 0;
            color: #374151;
            font-weight: 600;
        }

        .section-suggestion-info p {
            margin: 0;
            color: #6b7280;
            font-size: 0.875rem;
        }

        /* Styles responsive */
        @media (max-width: 768px) {
            .display-options .option-group {
                flex-direction: column;
            }

            .social-link-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }

            .reference-header {
                flex-direction: column;
                gap: 0.5rem;
            }

            .custom-section-header {
                flex-direction: column;
                gap: 0.75rem;
                align-items: flex-start;
            }
        }

        /* Animation pour les nouveaux éléments */
        .new-item-animation {
            animation: fadeInUp 0.3s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* For column resizing */
        .column-resizer {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 10px; /* Wider grab area */
            cursor: col-resize;
            transform: translateX(-50%);
            z-index: 20; /* High z-index */
        }
        .column-resizer::after {
            content: '';
            position: absolute;
            top: 0;
            bottom: 0;
            left: 4px; /* Centered 2px line in a 10px div */
            width: 2px;
            background-color: #d1d5db;
            transition: background-color 0.2s ease;
        }
        .column-resizer:hover::after,
        body.is-resizing .column-resizer::after {
            background-color: #3b82f6;
        }
        body.is-resizing {
            cursor: col-resize;
            user-select: none;
        }

        /* Panel resizing */
        .panel-resizer {
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            width: 8px;
            cursor: ew-resize;
            background: transparent;
            z-index: 10;
        }
        .panel-resizer::after {
            content: '';
            position: absolute;
            top: 0;
            bottom: 0;
            right: 3px;
            width: 2px;
            background-color: #d1d5db;
            transition: background-color 0.2s ease;
        }
        .panel-resizer:hover::after,
        body.is-panel-resizing .panel-resizer::after {
            background-color: #3b82f6;
        }
        body.is-panel-resizing {
            cursor: ew-resize;
            user-select: none;
        }

        /* Presentation Mode & Print Styles */
        body.presentation-mode .cv-column {
            border-color: transparent;
        }
        body.presentation-mode .column-resizer,
        body.presentation-mode .drag-handle,
        body.presentation-mode #ai-summarize-btn,
        body.presentation-mode .remove-page-btn,
        body.presentation-mode #add-page-btn-wrapper,
        body.presentation-mode .section-ai-actions,
        body.presentation-mode .delete-block-btn,
        body.presentation-mode .delete-line-btn,
        body.presentation-mode .insert-line-wrapper,
        body.presentation-mode .panel-resizer {
            display: none !important;
        }
        /* NEW: Completely hide the module in presentation mode if hidden */
        body.presentation-mode .cv-module.section-hidden {
            display: none !important;
        }

        @media print {
            body {
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
            .column-resizer,
            .drag-handle {
                display: none !important;
            }
            .cv-column {
                border-color: transparent !important;
            }
            .no-print {
                display: none !important;
            }
            .cv-module.section-hidden {
                display: none !important;
            }
            .a4-page {
                box-shadow: none !important;
                margin: 0;
                overflow: visible;
                height: auto;
                break-inside: avoid-page;
            }
            #cv-preview-wrapper {
                gap: 0;
            }
        }

        /* === NOUVEAUX STYLES DE MISE EN PAGE AVANCÉS === */

        /* Bannière inversée */
        .banner-inverted .banner-content-wrapper { flex-direction: row-reverse; }
        .banner-inverted .banner-contact { order: -1; }

        /* Layouts avancés */
        .layout-3-col { grid-template-columns: 1fr 1fr 1fr; }
        .layout-4-col { grid-template-columns: 1fr 1fr 1fr 1fr; }
        .layout-asymetric-left { grid-template-columns: 1.5fr 1fr; }
        .layout-asymetric-right { grid-template-columns: 1fr 1.5fr; }
        .layout-header-main { grid-template-rows: auto 1fr; grid-template-columns: 1fr; }
        .layout-sidebar-main { grid-template-columns: 300px 1fr; }
        .layout-main-sidebar { grid-template-columns: 1fr 300px; }

        /* Styles de colonnes spéciales */
        .column-highlight { background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(147, 51, 234, 0.1)); border: 2px solid rgba(59, 130, 246, 0.3); border-radius: 8px; }
        .column-shadow { box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); }
        .column-border { border: 2px solid var(--primary-color); border-radius: 8px; padding: 15px; }
        .column-rounded { border-radius: 12px; overflow: hidden; }

        /* Nouveaux styles de sections */
        .section-style-card { background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); padding: 15px; margin-bottom: 15px; }
        .section-style-glass { background: rgba(255,255,255,0.8); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; padding: 15px; }
        .section-style-gradient { background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); color: white; border-radius: 8px; padding: 15px; }
        .section-style-neumorphism { background: #e0e7ff; box-shadow: 8px 8px 16px #c8d0e7, -8px -8px 16px #ffffff; border-radius: 8px; padding: 15px; }

        /* Styles de texte avancés */
        .text-style-elegant { font-family: 'Playfair Display', serif; font-style: italic; }
        .text-style-modern { font-family: 'Montserrat', sans-serif; font-weight: 300; letter-spacing: 1px; }
        .text-style-bold { font-weight: 700; text-transform: uppercase; letter-spacing: 2px; }
        .text-style-handwritten { font-family: 'Kalam', cursive; }
        .text-style-gradient { background: linear-gradient(45deg, var(--primary-color), var(--secondary-color)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }

        /* Animations et effets */
        .animate-fade-in { animation: fadeIn 0.5s ease-in; }
        .animate-slide-up { animation: slideUp 0.5s ease-out; }
        .animate-scale-in { animation: scaleIn 0.3s ease-out; }
        .animate-bounce-in { animation: bounceIn 0.6s ease-out; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes scaleIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        @keyframes bounceIn { 0% { transform: scale(0.3); opacity: 0; } 50% { transform: scale(1.05); } 70% { transform: scale(0.9); } 100% { transform: scale(1); opacity: 1; } }

        /* Hover effects */
        .hover-lift { transition: transform 0.3s ease, box-shadow 0.3s ease; }
        .hover-lift:hover { transform: translateY(-5px); box-shadow: 0 10px 25px rgba(0,0,0,0.15); }

        .hover-glow { transition: box-shadow 0.3s ease; }
        .hover-glow:hover { box-shadow: 0 0 20px rgba(59, 130, 246, 0.4); }

        /* Espacement personnalisé */
        .spacing-compact .cv-module { margin-bottom: 0.5rem; }
        .spacing-relaxed .cv-module { margin-bottom: 2rem; }
        .spacing-generous .cv-module { margin-bottom: 3rem; }

        /* Bordures et séparateurs */
        .separator-line { border-bottom: 1px solid var(--primary-color); margin: 1rem 0; }
        .separator-dotted { border-bottom: 2px dotted var(--primary-color); margin: 1rem 0; }
        .separator-double { border-bottom: 3px double var(--primary-color); margin: 1rem 0; }
        .separator-gradient { height: 3px; background: linear-gradient(90deg, transparent, var(--primary-color), transparent); margin: 1rem 0; }

        /* Styles de fond de page */
        .page-bg-dots { background-image: radial-gradient(circle, var(--primary-color) 1px, transparent 1px); background-size: 20px 20px; }
        .page-bg-lines { background-image: linear-gradient(90deg, rgba(0,0,0,0.1) 1px, transparent 1px); background-size: 20px 20px; }
        .page-bg-grid { background-image: linear-gradient(rgba(0,0,0,0.1) 1px, transparent 1px), linear-gradient(90deg, rgba(0,0,0,0.1) 1px, transparent 1px); background-size: 20px 20px; }
        .page-bg-gradient { background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%); }

        /* Styles de police avancés */
        .font-script { font-family: 'Great Vibes', cursive; }
        .font-tech { font-family: 'JetBrains Mono', monospace; }
        .font-vintage { font-family: 'Cinzel', serif; }
        .font-clean { font-family: 'Inter', sans-serif; }

        /* Tailles de police étendues */
        .text-xs-custom { font-size: 8pt; }
        .text-sm-custom { font-size: 9pt; }
        .text-base-custom { font-size: 11pt; }
        .text-lg-custom { font-size: 13pt; }

        /* === STYLES AVANCÉS POUR LES NOUVELLES FONCTIONNALITÉS === */

        /* Styles de colonnes avancés */
        .column-style-highlight .cv-column { background: linear-gradient(135deg, rgba(59, 130, 246, 0.08), rgba(147, 51, 234, 0.08)); border: 1px solid rgba(59, 130, 246, 0.2); border-radius: 8px; padding: 10px; }
        .column-style-shadow .cv-column { box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15); border-radius: 8px; padding: 10px; }
        .column-style-border .cv-column { border: 2px solid var(--primary-color); border-radius: 8px; padding: 15px; }

        /* Fonds de page avancés */
        .bg-style-gradient .cv-page { background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 50%, #cbd5e1 100%); }
        .bg-style-dots .cv-page { background-image: radial-gradient(circle, rgba(59, 130, 246, 0.1) 1px, transparent 1px); background-size: 15px 15px; }
        .bg-style-lines .cv-page { background-image: linear-gradient(90deg, rgba(0,0,0,0.05) 1px, transparent 1px); background-size: 20px 20px; }

        /* Séparateurs avancés */
        :root { --separator-style: line; }
        .cv-module:not(:last-child)::after {
            content: '';
            display: block;
            margin: 1rem 0;
            height: 1px;
        }
        .cv-module:not(:last-child)::after {
            background: var(--primary-color);
        }

        /* Animations de page */
        .animation-fade-in .cv-page { animation: pageFadeIn 0.8s ease-in-out; }
        .animation-slide-up .cv-page { animation: pageSlideUp 0.6s ease-out; }
        .animation-scale-in .cv-page { animation: pageScaleIn 0.5s ease-out; }

        @keyframes pageFadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pageSlideUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes pageScaleIn {
            from { transform: scale(0.95); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        /* Boutons actifs pour les nouveaux contrôles */
        .column-style-btn.active, .bg-style-btn.active, .separator-btn.active, .animation-btn.active {
            background-color: #3b82f6;
            color: white;
        }
        .text-xl-custom { font-size: 15pt; }
        .text-2xl-custom { font-size: 18pt; }
        .text-3xl-custom { font-size: 22pt; }

        /* Couleurs étendues */
        .text-color-warm { color: #d97706; }
        .text-color-cool { color: #0891b2; }
        .text-color-muted { color: #64748b; }
        .text-color-accent { color: var(--primary-color); }

        /* Styles d'icônes */
        .icon-circle { background: var(--primary-color); color: white; border-radius: 50%; width: 20px; height: 20px; display: inline-flex; align-items: center; justify-content: center; font-size: 10px; }
        .icon-square { background: var(--secondary-color); color: white; border-radius: 4px; width: 20px; height: 20px; display: inline-flex; align-items: center; justify-content: center; font-size: 10px; }
        .icon-transparent { background: transparent; color: var(--primary-color); border: 2px solid var(--primary-color); border-radius: 50%; width: 20px; height: 20px; display: inline-flex; align-items: center; justify-content: center; font-size: 10px; }

        /* Dark theme base using CSS variables */
        :root {
            --bg-color: #f1f5f9;
            --text-color: #0f172a;
            --panel-bg: #ffffff;
            --panel-border: #e5e7eb;
            --tooltip-bg: rgba(15, 23, 42, 0.95);
        }
        .dark {
            --bg-color: #0f172a;
            --text-color: #e2e8f0;
            --panel-bg: #111827;
            --panel-border: #374151;
            --tooltip-bg: rgba(31,41,55,0.98);
        }
        body { background-color: var(--bg-color); color: var(--text-color); }
        #top-toolbar { background-color: var(--panel-bg); border-color: var(--panel-border); }
        #controls { background-color: var(--panel-bg); }
        .modal-content { background-color: var(--panel-bg); color: var(--text-color); }
        .a4-page-container { background-color: var(--panel-bg); }
        .tooltip-tailwind { background: var(--tooltip-bg); color: white; box-shadow: 0 8px 24px rgba(0,0,0,0.25); border-radius: 0.5rem; padding: 0.5rem 0.625rem; font-size: 0.75rem; }

    </style>
</head>
<body class="bg-gray-200 font-sans">

    <!-- OVERLAYS AND MODALS -->
    <div id="loader-overlay" class="hidden fixed inset-0 bg-white bg-opacity-75 flex-col items-center justify-center z-[9999]">
        <div class="h-16 w-16 rounded-full border-4 border-gray-200 border-t-blue-600 animate-spin"></div>
        <p id="loader-text" class="mt-4 text-gray-600 font-medium">Chargement...</p>
    </div>

    <div id="notification"></div>

    <!-- TOP TOOLBAR -->
    <div id="top-toolbar" class="w-full bg-white shadow-md border-b border-gray-200 px-4 py-2 flex flex-wrap items-center justify-between gap-2 no-print">
        <div class="flex items-center gap-2">
            <h1 class="text-lg font-bold text-gray-800">Créateur de CV</h1>
        </div>
        <div class="flex items-center gap-2 flex-wrap">
            <!-- API IA Selector -->
            <div class="flex items-center gap-1 bg-gray-100 rounded-md p-1">
                <select id="ai-provider-select" class="text-xs bg-transparent border-none outline-none">
                    <option value="gemini">Gemini</option>
                    <option value="chatgpt">ChatGPT</option>
                </select>
                <div id="api-status-indicator" class="w-2 h-2 rounded-full bg-gray-400" title="Statut API"></div>
                <button id="api-settings-btn" class="text-xs text-gray-600 hover:text-gray-800" title="Paramètres API">
                    <i class="fas fa-cog"></i>
                </button>
            </div>

            <div class="w-px h-6 bg-gray-300"></div>

            <button id="accessibility-btn" class="toolbar-btn bg-purple-600 text-white px-3 py-2 rounded-md hover:bg-purple-700 flex items-center gap-2 text-sm" title="Améliorer l'accessibilité du CV">
                <i class="fas fa-universal-access"></i> ACCESSIBILITÉ
            </button>
            <button id="save-cv-btn" class="toolbar-btn bg-blue-600 text-white px-3 py-2 rounded-md hover:bg-blue-700 flex items-center gap-2 text-sm" title="Sauvegarder le CV actuel avec tous les paramètres">
                <i class="fas fa-save"></i> SAUVEGARDER CV
            </button>
            <button id="load-cv-btn" class="toolbar-btn bg-blue-500 text-white px-3 py-2 rounded-md hover:bg-blue-600 flex items-center gap-2 text-sm" title="Charger un CV sauvegardé">
                <i class="fas fa-folder-open"></i> CHARGER CV
            </button>
            <button id="save-settings-btn" class="toolbar-btn bg-green-600 text-white px-3 py-2 rounded-md hover:bg-green-700 flex items-center gap-2 text-sm" title="Sauvegarder tous les paramètres (layout, couleurs, etc.)">
                <i class="fas fa-cogs"></i> SAUVEGARDER PARAMÈTRES
            </button>
            <button id="load-settings-btn" class="toolbar-btn bg-green-500 text-white px-3 py-2 rounded-md hover:bg-green-600 flex items-center gap-2 text-sm" title="Charger les paramètres sauvegardés">
                <i class="fas fa-folder"></i> CHARGER PARAMÈTRES
            </button>
            <button id="templates-btn" class="toolbar-btn bg-teal-600 text-white px-3 py-2 rounded-md hover:bg-teal-700 flex items-center gap-2 text-sm" title="Gérer les modèles de CV">
                <i class="fas fa-th-large"></i> TEMPLATES
            </button>
            <button id="download-pdf-btn" class="toolbar-btn bg-gray-800 text-white px-3 py-2 rounded-md hover:bg-gray-900 flex items-center gap-2 text-sm" title="Télécharger le CV en PDF">
                <i class="fa-solid fa-download"></i> PDF
            </button>
            <button id="share-btn" class="toolbar-btn bg-green-600 text-white px-3 py-2 rounded-md hover:bg-green-700 flex items-center gap-2 text-sm" title="Partager le CV">
                <i class="fa-solid fa-share-alt"></i> PARTAGER
            </button>
            <button id="anonymize-btn" class="toolbar-btn bg-slate-500 text-white px-3 py-2 rounded-md hover:bg-slate-600 flex items-center gap-2 text-sm" title="Anonymiser les informations personnelles">
                <i class="fa-solid fa-user-secret"></i> ANONYMISER
            </button>
            <button id="reset-cv-btn" class="toolbar-btn bg-red-600 text-white px-3 py-2 rounded-md hover:bg-red-700 flex items-center gap-2 text-sm" title="Créer un nouveau CV vierge">
                <i class="fa-solid fa-file-circle-plus"></i> NOUVEAU CV
            </button>
            <button id="toggle-overflow-btn" class="toolbar-btn bg-yellow-500 text-white px-3 py-2 rounded-md hover:bg-yellow-600 flex items-center gap-2 text-sm" title="Activer/désactiver la détection de dépassement de page">
                <i class="fa-solid fa-ruler-combined"></i> DÉTECTION DÉPASSEMENT
            </button>
            <button id="toggle-presentation-mode-btn" class="toolbar-btn bg-indigo-600 text-white px-3 py-2 rounded-md hover:bg-indigo-700 flex items-center gap-2 text-sm" title="Basculer en mode présentation">
                <i class="fa-solid fa-eye"></i> MODE PRÉSENTATION
            </button>
            <button id="toggle-dark-mode" class="toolbar-btn bg-slate-700 text-white px-3 py-2 rounded-md hover:bg-slate-800 flex items-center gap-2 text-sm" title="Basculer le thème sombre (Ctrl+D)">
                <i class="fa-solid fa-moon"></i> THÈME SOMBRE
            </button>
        </div>
    </div>

    <div class="flex flex-col lg:flex-row min-h-screen relative">
        <!-- CONTROLS PANEL -->
        <div id="controls" class="w-full lg:w-1/3 xl:w-1/4 p-6 bg-white shadow-2xl overflow-y-auto flex flex-col no-print relative">
            <div class="panel-resizer" id="controls-resizer"></div>
            <div class="flex justify-between items-center mb-4 flex-shrink-0">
                <div class="flex items-center gap-3"><i class="fas fa-magic-wand-sparkles text-3xl text-blue-600"></i><h1 class="text-2xl font-bold text-gray-800">Créateur de CV</h1></div>
                <div class="flex items-center gap-2">
                    <!-- Save status removed -->
                    <button id="undo-btn" class="history-btn text-xl text-gray-600 hover:text-gray-900 disabled:text-gray-300" title="Annuler (Ctrl+Z)"><i class="fas fa-undo"></i></button>
                    <button id="redo-btn" class="history-btn text-xl text-gray-600 hover:text-gray-900 disabled:text-gray-300" title="Rétablir (Ctrl+Y)"><i class="fas fa-redo"></i></button>
                </div>
            </div>
            
            <!-- NEW: Progress Bar -->
            <div class="mb-4 flex-shrink-0">
                <label class="text-sm font-medium text-gray-600">Progression</label>
                <div id="progress-bar-container" class="w-full bg-gray-200 rounded-full h-2.5 mt-1">
                    <div id="progress-bar" class="bg-green-500 h-2.5 rounded-full transition-all duration-300" style="width: 0%"></div>
                </div>
                <p id="progress-text" class="text-xs text-right text-gray-500 mt-1">0/X sections complétées</p>
            </div>

            <!-- Outils d'édition -->
            <div class="space-y-2 mb-4 p-4 bg-slate-50 rounded-lg border border-slate-200 flex-shrink-0">
                <button id="collapse-all-sections-btn" class="w-full bg-gray-600 text-white py-2 px-4 rounded-md hover:bg-gray-700 flex items-center justify-center gap-2" title="Réduire toutes les sections de contrôle">
                    <i class="fas fa-compress"></i> Réduire toutes les sections
                </button>
            </div>


            <!-- TABS -->
            <div id="tab-navigation" class="flex flex-wrap -mb-px border-b border-gray-200">
                <button class="tab-btn -mb-px py-3 px-4 text-sm font-medium border-b-2 whitespace-nowrap" data-target="#panel-ia" title="Fonctionnalités d'intelligence artificielle"><i class="fa-solid fa-robot mr-1"></i> IA</button>
                <button class="tab-btn -mb-px py-3 px-4 text-sm font-medium border-b-2 whitespace-nowrap" data-target="#panel-content" title="Édition du contenu du CV"><i class="fa-solid fa-file-lines mr-1"></i> Contenu</button>
                <button class="tab-btn -mb-px py-3 px-4 text-sm font-medium border-b-2 whitespace-nowrap" data-target="#panel-layout" title="Configuration de la mise en page"><i class="fa-solid fa-columns mr-1"></i> Mise en Page</button>
                <button class="tab-btn -mb-px py-3 px-4 text-sm font-medium border-b-2 whitespace-nowrap" data-target="#panel-banner" title="Personnalisation de la bannière"><i class="fa-solid fa-user-tie mr-1"></i> Bannière</button>
            </div>

            <div id="tab-content" class="py-4 flex-grow overflow-y-auto">
                <!-- TAB: IA -->
                <div id="panel-ia" class="tab-panel space-y-4">
                    <details class="control-group" open>
                        <summary><span>Analyse IA</span><label class="completion-label"><input type="checkbox" id="completion-ia-analyse" class="completion-checkbox"><span>Fait ✅</span></label></summary>
                        <div class="control-group-content space-y-2">
                            <textarea id="ai-input" rows="6" class="w-full p-2 border rounded-md" placeholder="Collez ici une description de poste, un CV brut..."></textarea>
                            <button id="analyze-btn" class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 flex items-center justify-center gap-2" title="Analyser le texte fourni et remplir automatiquement les champs du CV"><i class="fa-solid fa-wand-magic-sparkles"></i> Analyser & Remplir</button>
                        </div>
                    </details>
                    <details class="control-group" open>
                        <summary><span>Présentation Recruteur</span><label class="completion-label"><input type="checkbox" id="completion-ia-presentation" class="completion-checkbox"><span>Fait ✅</span></label></summary>
                        <div class="control-group-content space-y-3">
                            <input type="text" id="qualification-dispo" placeholder="Disponibilité" class="cv-input w-full p-2 border rounded-md">
                            <input type="text" id="qualification-salaire" placeholder="Prétentions salariales" class="cv-input w-full p-2 border rounded-md">
                            <input type="text" id="qualification-loc" placeholder="Localisation" class="cv-input w-full p-2 border rounded-md">
                            <button id="generate-mail-btn" class="mt-2 w-full bg-green-600 text-white py-2 px-4 rounded-md hover:bg-green-700 flex items-center justify-center gap-2" title="Générer un mail de présentation personnalisé pour le recruteur"><i class="fas fa-wand-magic-sparkles"></i> Générer le mail</button>
                            <textarea id="recruiter-mail-content" rows="8" class="cv-input w-full p-2 border rounded-md mt-2" placeholder="Le mail de présentation apparaîtra ici..."></textarea>
                        </div>
                    </details>
                    <details class="control-group" open>
                        <summary><span>Synthèse IA</span><label class="completion-label"><input type="checkbox" id="completion-ia-synthesis" class="completion-checkbox"><span>Fait ✅</span></label></summary>
                        <div class="control-group-content space-y-3">
                            <p class="text-sm text-gray-600">Utilisez cette fonction pour synthétiser automatiquement vos expériences professionnelles en 5 lignes maximum.</p>
                            <button id="ai-summarize-btn" class="w-full bg-purple-600 text-white py-3 px-4 rounded-md hover:bg-purple-700 flex items-center justify-center gap-2 text-lg" title="Synthèse IA des expériences (5 lignes max)">
                                <i class="fas fa-compress-arrows-alt"></i> Synthétiser les expériences
                            </button>
                        </div>
                    </details>
                </div>

                <!-- TAB: Contenu -->
                <div id="panel-content" class="tab-panel hidden space-y-4">
                    <!-- INFORMATIONS PERSONNELLES ÉTENDUES -->
                    <details class="control-group" open>
                        <summary><span>Informations Personnelles</span><label class="completion-label"><input type="checkbox" id="completion-content-personal" class="completion-checkbox"><span>Fait ✅</span></label></summary>
                        <div class="control-group-content space-y-4">
                            <!-- Coordonnées de base -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <input type="text" id="nom" placeholder="Nom" class="cv-input w-full p-2 border rounded-md">
                                <input type="text" id="prenom" placeholder="Prénom" class="cv-input w-full p-2 border rounded-md">
                            </div>

                            <!-- Photo de profil -->
                            <div class="border-t pt-4">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Photo de profil</label>
                                <div class="flex items-center gap-4">
                                    <input type="file" id="profile-photo" accept="image/*" class="cv-input flex-grow text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
                                    <button id="remove-profile-photo" class="text-red-500 hover:text-red-700" title="Supprimer la photo"><i class="fas fa-trash"></i></button>
                                </div>
                                <div class="mt-2 flex gap-2">
                                    <label class="flex items-center gap-2 text-sm">
                                        <input type="checkbox" id="photo-circular" class="cv-input" checked>
                                        Photo circulaire
                                    </label>
                                    <label class="flex items-center gap-2 text-sm">
                                        <input type="checkbox" id="photo-border" class="cv-input">
                                        Bordure
                                    </label>
                                </div>
                            </div>

                            <!-- Informations de contact étendues -->
                            <div class="border-t pt-4">
                                <h4 class="font-medium text-gray-700 mb-3">Coordonnées</h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <input type="email" id="email" placeholder="Email" class="cv-input w-full p-2 border rounded-md">
                                    <input type="tel" id="telephone" placeholder="Téléphone" class="cv-input w-full p-2 border rounded-md">
                                    <input type="url" id="site-web" placeholder="Site web" class="cv-input w-full p-2 border rounded-md">
                                    <input type="url" id="linkedin" placeholder="LinkedIn" class="cv-input w-full p-2 border rounded-md">
                                    <input type="text" id="adresse" placeholder="Adresse" class="cv-input w-full p-2 border rounded-md">
                                    <input type="text" id="ville" placeholder="Ville, Pays" class="cv-input w-full p-2 border rounded-md">
                                </div>
                            </div>

                            <!-- Informations professionnelles -->
                            <div class="border-t pt-4">
                                <h4 class="font-medium text-gray-700 mb-3">Situation Professionnelle</h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <input type="text" id="poste" placeholder="Poste recherché" class="cv-input w-full p-2 border rounded-md">
                                    <select id="situation-actuelle" class="cv-input w-full p-2 border rounded-md">
                                        <option value="">Situation actuelle</option>
                                        <option value="En poste">En poste</option>
                                        <option value="En recherche active">En recherche active</option>
                                        <option value="Disponible">Disponible</option>
                                        <option value="Étudiant">Étudiant</option>
                                        <option value="Freelance">Freelance</option>
                                    </select>
                                    <input type="text" id="secteur-recherche" placeholder="Secteur souhaité" class="cv-input w-full p-2 border rounded-md">
                                    <input type="text" id="mobilite" placeholder="Mobilité géographique" class="cv-input w-full p-2 border rounded-md">
                                    <input type="text" id="pretentions" placeholder="Prétentions salariales" class="cv-input w-full p-2 border rounded-md">
                                    <select id="disponibilite" class="cv-input w-full p-2 border rounded-md">
                                        <option value="">Disponibilité</option>
                                        <option value="Immédiate">Immédiate</option>
                                        <option value="1 mois">1 mois</option>
                                        <option value="2 mois">2 mois</option>
                                        <option value="3 mois">3 mois</option>
                                        <option value="À discuter">À discuter</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Profil détaillé -->
                            <div class="border-t pt-4">
                                <div class="flex justify-between items-center mb-2">
                                    <label class="font-medium text-gray-700">Profil / Description</label>
                                    <div class="flex gap-2">
                                        <button id="ai-rewrite-profile" class="text-blue-600 hover:text-blue-800" title="Réécrire avec l'IA"><i class="fas fa-magic-wand-sparkles"></i></button>
                                        <button id="ai-optimize-profile" class="text-blue-600 hover:text-blue-800" title="Optimiser pour le poste"><i class="fas fa-bullseye"></i></button>
                                    </div>
                                </div>
                                <textarea id="description" placeholder="Décrivez votre profil professionnel, vos objectifs, vos points forts..." rows="6" class="cv-input w-full p-2 border rounded-md"></textarea>
                                <div class="mt-2 text-sm text-gray-500">
                                    <span id="profile-char-count">0</span> caractères
                                </div>
                            </div>
                        </div>
                    </details>

                    <!-- EXPÉRIENCES PROFESSIONNELLES ÉTENDUES -->
                    <details class="control-group" open>
                        <summary><span>Expériences Professionnelles</span><label class="completion-label"><input type="checkbox" id="completion-content-exp" class="completion-checkbox"><span>Fait ✅</span></label></summary>
                        <div class="control-group-content space-y-3">
                            <div class="flex justify-between items-center mb-2">
                                <h4 class="font-medium text-gray-700">Liste des expériences</h4>
                                <div class="flex gap-2">
                                    <button id="add-experience" class="text-sm text-blue-600 hover:text-blue-800 font-medium"><i class="fas fa-circle-plus"></i> Ajouter</button>
                                    <button id="ai-summarize-all-exp" class="text-sm text-blue-600 hover:text-blue-800" title="Synthétiser toutes les expériences"><i class="fas fa-compress"></i></button>
                                </div>
                            </div>

                            <!-- Options d'affichage des expériences -->
                            <div class="bg-gray-50 p-3 rounded-md">
                                <h5 class="font-medium text-sm mb-2">Options d'affichage</h5>
                                <div class="flex flex-wrap gap-2">
                                    <label class="flex items-center gap-2 text-sm">
                                        <input type="checkbox" id="exp-show-dates" class="cv-input" checked>
                                        Afficher les dates
                                    </label>
                                    <label class="flex items-center gap-2 text-sm">
                                        <input type="checkbox" id="exp-show-location" class="cv-input" checked>
                                        Afficher le lieu
                                    </label>
                                    <label class="flex items-center gap-2 text-sm">
                                        <input type="checkbox" id="exp-show-company-size" class="cv-input">
                                        Taille entreprise
                                    </label>
                                    <label class="flex items-center gap-2 text-sm">
                                        <input type="checkbox" id="exp-show-sector" class="cv-input">
                                        Secteur
                                    </label>
                                    <label class="flex items-center gap-2 text-sm">
                                        <input type="checkbox" id="exp-show-contract" class="cv-input">
                                        Type de contrat
                                    </label>
                                </div>
                            </div>

                            <div id="experience-list" class="space-y-3"></div>
                        </div>
                    </details>

                    <!-- FORMATIONS ÉTENDUES -->
                    <details class="control-group" open>
                        <summary><span>Formations & Éducation</span><label class="completion-label"><input type="checkbox" id="completion-content-form" class="completion-checkbox"><span>Fait ✅</span></label></summary>
                        <div class="control-group-content space-y-3">
                            <div class="flex justify-between items-center mb-2">
                                <h4 class="font-medium text-gray-700">Parcours éducatif</h4>
                                <div class="flex gap-2">
                                    <button id="add-formation" class="text-sm text-blue-600 hover:text-blue-800 font-medium"><i class="fas fa-circle-plus"></i> Ajouter</button>
                                    <button id="ai-improve-formations" class="text-sm text-blue-600 hover:text-blue-800" title="Améliorer la formulation"><i class="fas fa-magic-wand-sparkles"></i></button>
                                </div>
                            </div>

                            <!-- Options d'affichage des formations -->
                            <div class="bg-gray-50 p-3 rounded-md">
                                <h5 class="font-medium text-sm mb-2">Options d'affichage</h5>
                                <div class="flex flex-wrap gap-2">
                                    <label class="flex items-center gap-2 text-sm">
                                        <input type="checkbox" id="form-show-establishment" class="cv-input" checked>
                                        Établissement
                                    </label>
                                    <label class="flex items-center gap-2 text-sm">
                                        <input type="checkbox" id="form-show-level" class="cv-input" checked>
                                        Niveau d'études
                                    </label>
                                    <label class="flex items-center gap-2 text-sm">
                                        <input type="checkbox" id="form-show-specialization" class="cv-input">
                                        Spécialisation
                                    </label>
                                    <label class="flex items-center gap-2 text-sm">
                                        <input type="checkbox" id="form-show-mention" class="cv-input">
                                        Mention obtenue
                                    </label>
                                    <label class="flex items-center gap-2 text-sm">
                                        <input type="checkbox" id="form-show-duration" class="cv-input">
                                        Durée
                                    </label>
                                </div>
                            </div>

                            <div id="formation-list" class="space-y-3"></div>
                        </div>
                    </details>

                    <!-- COMPÉTENCES ÉTENDUES -->
                    <details class="control-group" open>
                        <summary><span>Compétences & Technologies</span><label class="completion-label"><input type="checkbox" id="completion-skills" class="completion-checkbox"><span>Fait ✅</span></label></summary>
                        <div class="control-group-content space-y-4">
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <!-- Style de présentation -->
                                <div>
                                    <p class="text-sm font-medium mb-2">Style de Présentation</p>
                                    <div class="flex flex-col gap-2">
                                        <button data-skill-style="tags" class="skill-style-btn flex-1 bg-gray-200 p-2 rounded-md text-sm active" title="Afficher les compétences sous forme de tags">Tags</button>
                                        <button data-skill-style="levels" class="skill-style-btn flex-1 bg-gray-200 p-2 rounded-md text-sm" title="Afficher les compétences avec niveaux">Niveaux</button>
                                        <button data-skill-style="simple" class="skill-style-btn flex-1 bg-gray-200 p-2 rounded-md text-sm" title="Afficher les compétences sous forme simple">Simple</button>
                                    </div>
                                </div>

                                <!-- Catégorisation -->
                                <div>
                                    <p class="text-sm font-medium mb-2">Catégorisation</p>
                                    <div class="flex flex-col gap-2">
                                        <button id="ai-categorize-skills" class="bg-blue-100 text-blue-800 py-2 px-3 rounded-md hover:bg-blue-200 text-sm" title="Organiser automatiquement par catégories">
                                            <i class="fas fa-tags"></i> Auto-catégoriser
                                        </button>
                                        <button id="add-skill-category" class="bg-gray-100 text-gray-800 py-2 px-3 rounded-md hover:bg-gray-200 text-sm" title="Ajouter une catégorie personnalisée">
                                            <i class="fas fa-plus"></i> Nouvelle catégorie
                                        </button>
                                    </div>
                                </div>

                                <!-- Actions IA -->
                                <div>
                                    <p class="text-sm font-medium mb-2">Actions IA</p>
                                    <div class="flex flex-col gap-2">
                                        <button id="ai-limit-skills-btn" class="bg-green-100 text-green-800 py-2 px-3 rounded-md hover:bg-green-200 text-sm" title="Limiter à 10 compétences par l'IA">
                                            <i class="fas fa-filter"></i> Top 10
                                        </button>
                                        <button id="ai-synthesize-skills-btn" class="bg-purple-100 text-purple-800 py-2 px-3 rounded-md hover:bg-purple-200 text-sm" title="Synthétiser et ranger les compétences par l'IA">
                                            <i class="fas fa-brain"></i> Synthétiser
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Liste des compétences textuelles -->
                            <div id="skills-text-controls">
                                <div class="flex justify-between items-center">
                                    <label for="competences" class="font-medium">Liste des compétences</label>
                                    <div class="flex gap-2">
                                        <button id="import-skills-from-exp" class="text-sm text-orange-600 hover:text-orange-800" title="Extraire des expériences"><i class="fas fa-upload"></i></button>
                                        <button id="export-skills" class="text-sm text-green-600 hover:text-green-800" title="Exporter"><i class="fas fa-download"></i></button>
                                    </div>
                                </div>
                                <textarea id="competences" placeholder="Compétences (séparées par des virgules)..." rows="4" class="cv-input w-full p-2 border rounded-md"></textarea>
                                <div class="mt-2 text-sm text-gray-500">
                                    <span id="skills-count">0</span> compétences listées
                                </div>
                            </div>

                            <!-- Compétences avec niveaux -->
                            <div id="skills-level-controls" class="hidden space-y-3 border-t pt-3">
                                <div class="flex justify-between items-center">
                                    <h5 class="font-medium">Compétences avec niveaux</h5>
                                    <button id="add-skill-level-btn" class="text-sm text-blue-600 hover:text-blue-800">
                                        <i class="fas fa-plus"></i> Ajouter
                                    </button>
                                </div>

                                <p class="text-sm font-medium">Style de Jauge</p>
                                <div class="grid grid-cols-5 gap-2 text-center">
                                    <button data-gauge-style="bar" class="gauge-style-btn bg-gray-200 p-2 rounded-md text-sm active" title="Barre"><i class="fas fa-bars"></i></button>
                                    <button data-gauge-style="dots" class="gauge-style-btn bg-gray-200 p-2 rounded-md text-sm" title="Points"><i class="fas fa-circle"></i></button>
                                    <button data-gauge-style="stars" class="gauge-style-btn bg-gray-200 p-2 rounded-md text-sm" title="Étoiles"><i class="fas fa-star"></i></button>
                                    <button data-gauge-style="squares" class="gauge-style-btn bg-gray-200 p-2 rounded-md text-sm" title="Carrés"><i class="fas fa-square"></i></button>
                                    <button data-gauge-style="number" class="gauge-style-btn bg-gray-200 p-2 rounded-md text-sm font-bold" title="Chiffres">⅗</button>
                                </div>

                                <div id="skills-level-list" class="space-y-2 border-t pt-3"></div>
                            </div>
                        </div>
                    </details>

                    <!-- LANGUES -->
                    <details class="control-group" open>
                        <summary><span>Langues</span><label class="completion-label"><input type="checkbox" id="completion-languages" class="completion-checkbox"><span>Fait ✅</span></label></summary>
                        <div class="control-group-content space-y-3">
                            <div class="flex justify-between items-center mb-2">
                                <h4 class="font-medium text-gray-700">Langues maîtrisées</h4>
                                <button id="add-language" class="text-sm text-blue-600 hover:text-blue-800 font-medium">
                                    <i class="fas fa-circle-plus"></i> Ajouter une langue
                                </button>
                            </div>

                            <div class="bg-gray-50 p-3 rounded-md mb-4">
                                <h5 class="font-medium text-sm mb-2">Options d'affichage</h5>
                                <div class="flex flex-wrap gap-2">
                                    <label class="flex items-center gap-2 text-sm">
                                        <input type="checkbox" id="lang-show-level" class="cv-input" checked>
                                        Niveau de maîtrise
                                    </label>
                                    <label class="flex items-center gap-2 text-sm">
                                        <input type="checkbox" id="lang-show-certification" class="cv-input">
                                        Certifications
                                    </label>
                                    <label class="flex items-center gap-2 text-sm">
                                        <input type="checkbox" id="lang-show-flag" class="cv-input">
                                        Drapeaux
                                    </label>
                                </div>
                            </div>

                            <div id="languages-list" class="space-y-3"></div>
                        </div>
                    </details>

                    <!-- PROJETS PERSONNELS -->
                    <details class="control-group">
                        <summary><span>Projets Personnels</span><label class="completion-label"><input type="checkbox" id="completion-projects" class="completion-checkbox"><span>Fait ✅</span></label></summary>
                        <div class="control-group-content space-y-3">
                            <div class="flex justify-between items-center mb-2">
                                <h4 class="font-medium text-gray-700">Projets personnels & open source</h4>
                                <button id="add-project" class="text-sm text-blue-600 hover:text-blue-800 font-medium">
                                    <i class="fas fa-circle-plus"></i> Ajouter un projet
                                </button>
                            </div>

                            <div class="bg-gray-50 p-3 rounded-md mb-4">
                                <h5 class="font-medium text-sm mb-2">Options d'affichage</h5>
                                <div class="flex flex-wrap gap-2">
                                    <label class="flex items-center gap-2 text-sm">
                                        <input type="checkbox" id="project-show-tech" class="cv-input" checked>
                                        Technologies utilisées
                                    </label>
                                    <label class="flex items-center gap-2 text-sm">
                                        <input type="checkbox" id="project-show-links" class="cv-input" checked>
                                        Liens (GitHub, démo)
                                    </label>
                                    <label class="flex items-center gap-2 text-sm">
                                        <input type="checkbox" id="project-show-description" class="cv-input" checked>
                                        Description
                                    </label>
                                    <label class="flex items-center gap-2 text-sm">
                                        <input type="checkbox" id="project-show-screenshots" class="cv-input">
                                        Captures d'écran
                                    </label>
                                </div>
                            </div>

                            <div id="projects-list" class="space-y-3"></div>
                        </div>
                    </details>

                    <!-- CERTIFICATIONS -->
                    <details class="control-group">
                        <summary><span>Certifications & Diplômes</span><label class="completion-label"><input type="checkbox" id="completion-certifications" class="completion-checkbox"><span>Fait ✅</span></label></summary>
                        <div class="control-group-content space-y-3">
                            <div class="flex justify-between items-center mb-2">
                                <h4 class="font-medium text-gray-700">Certifications obtenues</h4>
                                <button id="add-certification" class="text-sm text-blue-600 hover:text-blue-800 font-medium">
                                    <i class="fas fa-circle-plus"></i> Ajouter une certification
                                </button>
                            </div>

                            <div class="bg-gray-50 p-3 rounded-md mb-4">
                                <h5 class="font-medium text-sm mb-2">Options d'affichage</h5>
                                <div class="flex flex-wrap gap-2">
                                    <label class="flex items-center gap-2 text-sm">
                                        <input type="checkbox" id="cert-show-organism" class="cv-input" checked>
                                        Organisme certificateur
                                    </label>
                                    <label class="flex items-center gap-2 text-sm">
                                        <input type="checkbox" id="cert-show-date" class="cv-input" checked>
                                        Date d'obtention
                                    </label>
                                    <label class="flex items-center gap-2 text-sm">
                                        <input type="checkbox" id="cert-show-expiry" class="cv-input">
                                        Date d'expiration
                                    </label>
                                    <label class="flex items-center gap-2 text-sm">
                                        <input type="checkbox" id="cert-show-score" class="cv-input">
                                        Score obtenu
                                    </label>
                                </div>
                            </div>

                            <div id="certifications-list" class="space-y-3"></div>
                        </div>
                    </details>

                    <!-- CENTRES D'INTÉRÊT -->
                    <details class="control-group">
                        <summary><span>Centres d'Intérêt</span><label class="completion-label"><input type="checkbox" id="completion-interests" class="completion-checkbox"><span>Fait ✅</span></label></summary>
                        <div class="control-group-content space-y-3">
                            <div class="flex justify-between items-center mb-2">
                                <h4 class="font-medium text-gray-700">Activités et centres d'intérêt</h4>
                                <div class="flex gap-2">
                                    <button id="add-interest" class="text-sm text-blue-600 hover:text-blue-800 font-medium">
                                        <i class="fas fa-circle-plus"></i> Ajouter
                                    </button>
                                    <button id="ai-suggest-interests-btn" class="text-sm text-purple-600 hover:text-purple-800" title="Suggestions IA">
                                        <i class="fas fa-lightbulb"></i>
                                    </button>
                                </div>
                            </div>

                            <div class="bg-gray-50 p-3 rounded-md mb-4">
                                <h5 class="font-medium text-sm mb-2">Style d'affichage</h5>
                                <div class="flex flex-wrap gap-2">
                                    <button id="interests-style-list" class="bg-blue-100 text-blue-800 py-1 px-3 rounded-md text-sm active">Liste</button>
                                    <button id="interests-style-icons" class="bg-gray-100 text-gray-800 py-1 px-3 rounded-md text-sm">Icônes</button>
                                    <button id="interests-style-tags" class="bg-gray-100 text-gray-800 py-1 px-3 rounded-md text-sm">Tags</button>
                                </div>
                            </div>

                            <textarea id="interests" placeholder="Sports, voyages, lecture, musique, cinéma, etc." rows="4" class="cv-input w-full p-2 border rounded-md"></textarea>
                            <div class="mt-2 text-sm text-gray-500">
                                <span id="interests-count">0</span> centres d'intérêt listés
                            </div>
                        </div>
                    </details>

                    <!-- RÉFÉRENCES PROFESSIONNELLES -->
                    <details class="control-group">
                        <summary><span>Références Professionnelles</span><label class="completion-label"><input type="checkbox" id="completion-references" class="completion-checkbox"><span>Fait ✅</span></label></summary>
                        <div class="control-group-content space-y-3">
                            <div class="flex justify-between items-center mb-2">
                                <h4 class="font-medium text-gray-700">Références professionnelles</h4>
                                <button id="add-reference" class="text-sm text-blue-600 hover:text-blue-800 font-medium">
                                    <i class="fas fa-circle-plus"></i> Ajouter une référence
                                </button>
                            </div>

                            <div class="bg-gray-50 p-3 rounded-md mb-4">
                                <h5 class="font-medium text-sm mb-2">Options d'affichage</h5>
                                <div class="flex flex-wrap gap-2">
                                    <label class="flex items-center gap-2 text-sm">
                                        <input type="checkbox" id="ref-show-company" class="cv-input" checked>
                                        Entreprise
                                    </label>
                                    <label class="flex items-center gap-2 text-sm">
                                        <input type="checkbox" id="ref-show-position" class="cv-input" checked>
                                        Poste occupé
                                    </label>
                                    <label class="flex items-center gap-2 text-sm">
                                        <input type="checkbox" id="ref-show-contact" class="cv-input">
                                        Coordonnées
                                    </label>
                                    <label class="flex items-center gap-2 text-sm">
                                        <input type="checkbox" id="ref-show-relationship" class="cv-input">
                                        Relation professionnelle
                                    </label>
                                </div>
                            </div>

                            <div id="references-list" class="space-y-3"></div>
                        </div>
                    </details>

                    <!-- PORTFOLIO & LIENS -->
                    <details class="control-group">
                        <summary><span>Portfolio & Liens</span><label class="completion-label"><input type="checkbox" id="completion-portfolio" class="completion-checkbox"><span>Fait ✅</span></label></summary>
                        <div class="control-group-content space-y-3">
                            <h4 class="font-medium text-gray-700 mb-3">Liens professionnels</h4>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Portfolio personnel</label>
                                    <input type="url" id="portfolio-url" placeholder="https://monportfolio.com" class="cv-input w-full p-2 border rounded-md">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">GitHub</label>
                                    <input type="url" id="github-url" placeholder="https://github.com/username" class="cv-input w-full p-2 border rounded-md">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">LinkedIn</label>
                                    <input type="url" id="linkedin-url" placeholder="https://linkedin.com/in/username" class="cv-input w-full p-2 border rounded-md">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Site web professionnel</label>
                                    <input type="url" id="website-url" placeholder="https://monsite.com" class="cv-input w-full p-2 border rounded-md">
                                </div>
                            </div>

                            <div class="border-t pt-4">
                                <div class="flex justify-between items-center mb-2">
                                    <h5 class="font-medium text-gray-700">Réseaux sociaux professionnels</h5>
                                    <button id="add-social-link" class="text-sm text-blue-600 hover:text-blue-800">
                                        <i class="fas fa-plus"></i> Ajouter
                                    </button>
                                </div>
                                <div id="social-links-list" class="space-y-2"></div>
                            </div>
                        </div>
                    </details>

                    <!-- SECTIONS PERSONNALISÉES -->
                    <details class="control-group" open>
                        <summary><span>Sections Personnalisées</span><label class="completion-label"><input type="checkbox" id="completion-custom" class="completion-checkbox"><span>Fait ✅</span></label></summary>
                        <div class="control-group-content space-y-3">
                            <div class="space-y-2">
                                <label class="text-sm font-medium">Ajouter une nouvelle section</label>
                                <select id="section-suggestion-select" class="w-full p-2 border rounded-md text-sm">
                                    <option value="">-- Choisir une suggestion --</option>
                                    <option value="Langues 🌐">Langues 🌐</option>
                                    <option value="Centres d'intérêt 🎨">Centres d'intérêt 🎨</option>
                                    <option value="Certifications 📜">Certifications 📜</option>
                                    <option value="Projets Personnels 💡">Projets Personnels 💡</option>
                                    <option value="Bénévolat ❤️">Bénévolat ❤️</option>
                                    <option value="Publications 📚">Publications 📚</option>
                                    <option value="Conférences 🎤">Conférences 🎤</option>
                                    <option value="Récompenses 🏆">Récompenses 🏆</option>
                                    <option value="Logiciels maîtrisés 💻">Logiciels maîtrisés 💻</option>
                                    <option value="Outils & Méthodologies 🛠️">Outils & Méthodologies 🛠️</option>
                                </select>
                                <div class="flex gap-2">
                                    <input type="text" id="new-section-title-input" class="flex-grow p-2 border rounded-md text-sm" placeholder="Ou tapez un titre personnalisé...">
                                    <button id="add-section-btn" class="bg-indigo-500 text-white py-2 px-4 rounded-md hover:bg-indigo-600" title="Ajouter une nouvelle section personnalisée">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                            </div>
                            <div id="custom-sections-list" class="space-y-2 mt-2 border-t pt-2"></div>
                        </div>
                    </details>
                </div>

                <!-- TAB: Mise en Page -->
                <div id="panel-layout" class="tab-panel hidden space-y-4">
                    <details class="control-group" open>
                        <summary><span>Mise en Colonnes</span><label class="completion-label"><input type="checkbox" id="completion-layout-cols" class="completion-checkbox"><span>Fait ✅</span></label></summary>
                        <div class="control-group-content">
                            <div class="flex gap-2"><button data-layout="layout-1-col" class="layout-btn flex-1 bg-gray-200 p-2 rounded-md text-sm" title="Mise en page à une colonne">1</button><button data-layout="layout-2-col-33-67" class="layout-btn flex-1 bg-gray-200 p-2 rounded-md text-sm" title="Mise en page deux colonnes 33/67">33/67</button><button data-layout="layout-2-col-50-50" class="layout-btn flex-1 bg-gray-200 p-2 rounded-md text-sm" title="Mise en page deux colonnes 50/50">50/50</button><button data-layout="layout-2-col-67-33" class="layout-btn flex-1 bg-gray-200 p-2 rounded-md text-sm" title="Mise en page deux colonnes 67/33">67/33</button></div>
                            <div class="flex gap-2 mt-2"><button data-layout="layout-3-col" class="layout-btn flex-1 bg-gray-200 p-2 rounded-md text-sm" title="Mise en page trois colonnes">3 COL</button><button data-layout="layout-asymetric-left" class="layout-btn flex-1 bg-gray-200 p-2 rounded-md text-sm" title="Layout asymétrique gauche">ASY G</button><button data-layout="layout-asymetric-right" class="layout-btn flex-1 bg-gray-200 p-2 rounded-md text-sm" title="Layout asymétrique droite">ASY D</button><button data-layout="layout-sidebar-main" class="layout-btn flex-1 bg-gray-200 p-2 rounded-md text-sm" title="Sidebar + contenu">SIDEBAR</button></div>
                        </div>
                    </details>
                    <details class="control-group" open>
                        <summary><span>Styles Avancés</span><label class="completion-label"><input type="checkbox" id="completion-layout-advanced" class="completion-checkbox"><span>Fait ✅</span></label></summary>
                        <div class="control-group-content space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Style de Colonnes</label>
                                <div class="grid grid-cols-2 gap-2">
                                    <button data-column-style="normal" class="column-style-btn flex-1 bg-gray-200 p-2 rounded-md text-sm" title="Style normal">Normal</button>
                                    <button data-column-style="highlight" class="column-style-btn flex-1 bg-gray-200 p-2 rounded-md text-sm" title="Colonne mise en évidence">En évidence</button>
                                    <button data-column-style="shadow" class="column-style-btn flex-1 bg-gray-200 p-2 rounded-md text-sm" title="Ombre portée">Ombre</button>
                                    <button data-column-style="border" class="column-style-btn flex-1 bg-gray-200 p-2 rounded-md text-sm" title="Bordure colorée">Bordure</button>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Fond de Page</label>
                                <div class="grid grid-cols-2 gap-2">
                                    <button data-bg-style="normal" class="bg-style-btn flex-1 bg-gray-200 p-2 rounded-md text-sm" title="Fond normal">Normal</button>
                                    <button data-bg-style="gradient" class="bg-style-btn flex-1 bg-gray-200 p-2 rounded-md text-sm" title="Dégradé subtil">Dégradé</button>
                                    <button data-bg-style="dots" class="bg-style-btn flex-1 bg-gray-200 p-2 rounded-md text-sm" title="Motif pointillé">Points</button>
                                    <button data-bg-style="lines" class="bg-style-btn flex-1 bg-gray-200 p-2 rounded-md text-sm" title="Lignes discrètes">Lignes</button>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Séparateurs</label>
                                <div class="grid grid-cols-2 gap-2">
                                    <button data-separator="line" class="separator-btn flex-1 bg-gray-200 p-2 rounded-md text-sm" title="Ligne simple">Ligne</button>
                                    <button data-separator="dotted" class="separator-btn flex-1 bg-gray-200 p-2 rounded-md text-sm" title="Ligne pointillée">Pointillé</button>
                                    <button data-separator="double" class="separator-btn flex-1 bg-gray-200 p-2 rounded-md text-sm" title="Double ligne">Double</button>
                                    <button data-separator="gradient" class="separator-btn flex-1 bg-gray-200 p-2 rounded-md text-sm" title="Dégradé">Dégradé</button>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Animations</label>
                                <div class="grid grid-cols-2 gap-2">
                                    <button data-animation="none" class="animation-btn flex-1 bg-gray-200 p-2 rounded-md text-sm" title="Aucune animation">Aucune</button>
                                    <button data-animation="fade-in" class="animation-btn flex-1 bg-gray-200 p-2 rounded-md text-sm" title="Fondu en entrée">Fondu</button>
                                    <button data-animation="slide-up" class="animation-btn flex-1 bg-gray-200 p-2 rounded-md text-sm" title="Glissement vers le haut">Glisse</button>
                                    <button data-animation="scale-in" class="animation-btn flex-1 bg-gray-200 p-2 rounded-md text-sm" title="Zoom en entrée">Zoom</button>
                                </div>
                            </div>
                        </div>
                    </details>
                    <details class="control-group" open>
                        <summary><span>Espacements & Tailles</span><label class="completion-label"><input type="checkbox" id="completion-layout-spacing" class="completion-checkbox"><span>Fait ✅</span></label></summary>
                        <div class="control-group-content space-y-4">
                            <div><label for="page-margin" class="block text-sm font-medium text-gray-700">Marge Page: <span id="page-margin-value">2</span>cm</label><input type="range" id="page-margin" min="0.5" max="3" step="0.1" value="2" class="cv-input w-full h-2 bg-gray-200 rounded-lg cursor-pointer"></div>
                            <div><label for="module-spacing" class="block text-sm font-medium text-gray-700">Espace Blocs: <span id="module-spacing-value">1.5</span>rem</label><input type="range" id="module-spacing" min="0" max="4" step="0.1" value="1.5" class="cv-input w-full h-2 bg-gray-200 rounded-lg cursor-pointer"></div>
                            <div><label for="item-spacing" class="block text-sm font-medium text-gray-700">Espace Éléments: <span id="item-spacing-value">0.5</span>rem</label><input type="range" id="item-spacing" min="0" max="2" step="0.1" value="0.5" class="cv-input w-full h-2 bg-gray-200 rounded-lg cursor-pointer"></div>
                            <div><label for="font-size-h1" class="block text-sm font-medium text-gray-700">Taille Titre Principal: <span id="font-size-h1-value">40</span>pt</label><input type="range" id="font-size-h1" min="20" max="50" step="1" value="40" class="cv-input w-full h-2 bg-gray-200 rounded-lg cursor-pointer"></div><div><label for="font-size-h2" class="block text-sm font-medium text-gray-700">Taille Titres Section: <span id="font-size-h2-value">21</span>pt</label><input type="range" id="font-size-h2" min="14" max="30" step="1" value="21" class="cv-input w-full h-2 bg-gray-200 rounded-lg cursor-pointer"></div><div><label for="font-size-p" class="block text-sm font-medium text-gray-700">Taille Paragraphe: <span id="font-size-p-value">10</span>pt</label><input type="range" id="font-size-p" min="8" max="14" step="0.5" value="10" class="cv-input w-full h-2 bg-gray-200 rounded-lg cursor-pointer"></div><div><label for="font-size-banner" class="block text-sm font-medium text-gray-700">Taille Bannière: <span id="font-size-banner-value">9</span>pt</label><input type="range" id="font-size-banner" min="7" max="12" step="0.5" value="9" class="cv-input w-full h-2 bg-gray-200 rounded-lg cursor-pointer"></div><div><label for="line-height" class="block text-sm font-medium text-gray-700">Interligne: <span id="line-height-value">1.6</span></label><input type="range" id="line-height" min="0.8" max="2.5" step="0.1" value="1.6" class="cv-input w-full h-2 bg-gray-200 rounded-lg cursor-pointer"></div><div><label for="paragraph-spacing" class="block text-sm font-medium text-gray-700">Espace Paragraphe: <span id="paragraph-spacing-value">0.5</span>rem</label><input type="range" id="paragraph-spacing" min="0" max="2" step="0.1" value="0.5" class="cv-input w-full h-2 bg-gray-200 rounded-lg cursor-pointer"></div>
                        </div>
                    </details>
                    <details class="control-group" open>
                        <summary><span>Thèmes</span><label class="completion-label"><input type="checkbox" id="completion-styles-themes" class="completion-checkbox"><span>Fait ✅</span></label></summary>
                        <div class="control-group-content">
                            <div id="theme-buttons" class="grid grid-cols-3 gap-2">
                                <button data-theme="professional" class="theme-btn bg-gray-200 p-2 rounded-md text-sm">Pro</button>
                                <button data-theme="creative" class="theme-btn bg-gray-200 p-2 rounded-md text-sm">Créatif</button>
                                <button data-theme="modern" class="theme-btn bg-gray-200 p-2 rounded-md text-sm">Moderne</button>
                            </div>
                        </div>
                    </details>
                    <details class="control-group" open>
                        <summary><span>Couleurs</span><label class="completion-label"><input type="checkbox" id="completion-styles-colors" class="completion-checkbox"><span>Fait ✅</span></label></summary>
                        <div class="control-group-content">
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label for="primary-color-picker" class="block text-sm font-medium text-gray-700">Principale</label>
                                    <input type="color" id="primary-color-picker" value="#2563eb" class="cv-input w-full h-10 p-1 border rounded-md">
                                </div>
                                <div>
                                    <label for="secondary-color-picker" class="block text-sm font-medium text-gray-700">Secondaire</label>
                                    <div class="flex items-center">
                                        <input type="color" id="secondary-color-picker" value="#334155" class="cv-input w-full h-10 p-1 border rounded-md">
                                        <button id="ai-color-btn" title="Suggestion IA" class="ml-2 text-blue-600 hover:text-blue-800"><i class="fas fa-wand-magic-sparkles"></i></button>
                                    </div>
                                </div>
                                <div class="col-span-2">
                                    <label for="body-text-color-picker" class="block text-sm font-medium text-gray-700">Texte du corps</label>
                                    <input type="color" id="body-text-color-picker" value="#334155" class="cv-input w-full h-10 p-1 border rounded-md">
                                </div>
                                <div class="col-span-2">
                                    <button id="suggest-colors" class="w-full bg-gradient-to-r from-blue-500 to-purple-600 text-white py-2 px-4 rounded-md hover:from-blue-600 hover:to-purple-700 flex items-center justify-center gap-2">
                                        <i class="fas fa-palette"></i> Suggestions de couleurs
                                    </button>
                                </div>
                            </div>
                        </div>
                    </details>
                </div>
                
                <!-- TAB: Styles Globaux -->
                <div id="panel-styles" class="tab-panel hidden space-y-4">
                     <details class="control-group" open>
                        <summary><span>Thèmes</span><label class="completion-label"><input type="checkbox" id="completion-styles-themes" class="completion-checkbox"><span>Fait ✅</span></label></summary>
                        <div class="control-group-content">
                            <div id="theme-buttons" class="grid grid-cols-3 gap-2">
                                <button data-theme="professional" class="theme-btn bg-gray-200 p-2 rounded-md text-sm">Pro</button>
                                <button data-theme="creative" class="theme-btn bg-gray-200 p-2 rounded-md text-sm">Créatif</button>
                                <button data-theme="modern" class="theme-btn bg-gray-200 p-2 rounded-md text-sm">Moderne</button>
                            </div>
                        </div>
                    </details>
                     <details class="control-group" open>
                        <summary><span>Couleurs</span><label class="completion-label"><input type="checkbox" id="completion-styles-colors" class="completion-checkbox"><span>Fait ✅</span></label></summary>
                        <div class="control-group-content">
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label for="primary-color-picker" class="block text-sm font-medium text-gray-700">Principale</label>
                                    <input type="color" id="primary-color-picker" value="#2563eb" class="cv-input w-full h-10 p-1 border rounded-md">
                                </div>
                                <div>
                                    <label for="secondary-color-picker" class="block text-sm font-medium text-gray-700">Secondaire</label>
                                    <div class="flex items-center">
                                        <input type="color" id="secondary-color-picker" value="#334155" class="cv-input w-full h-10 p-1 border rounded-md">
                                        <button id="ai-color-btn" title="Suggestion IA" class="ml-2 text-blue-600 hover:text-blue-800"><i class="fas fa-wand-magic-sparkles"></i></button>
                                    </div>
                                </div>
                                <div class="col-span-2">
                                    <label for="body-text-color-picker" class="block text-sm font-medium text-gray-700">Texte du corps</label>
                                    <input type="color" id="body-text-color-picker" value="#334155" class="cv-input w-full h-10 p-1 border rounded-md">
                                </div>
                            </div>
                        </div>
                    </details>
                     <details class="control-group" open>
                        <summary><span>Polices</span><label class="completion-label"><input type="checkbox" id="completion-styles-fonts" class="completion-checkbox"><span>Fait ✅</span></label></summary>
                        <div class="control-group-content space-y-4">
                            <div>
                                <label for="font-family-h1-select" class="block text-sm font-medium text-gray-700">Titre Principal (H1)</label>
                                <select id="font-family-h1-select" class="cv-input w-full p-2 border rounded-md"></select>
                            </div>
                            <div>
                                <label for="font-family-h2-select" class="block text-sm font-medium text-gray-700">Titres de Section (H2)</label>
                                <select id="font-family-h2-select" class="cv-input w-full p-2 border rounded-md"></select>
                            </div>
                            <div>
                                <label for="font-family-body-select" class="block text-sm font-medium text-gray-700">Corps de Texte</label>
                                <select id="font-family-body-select" class="cv-input w-full p-2 border rounded-md"></select>
                            </div>
                        </div>
                    </details>
                     <details class="control-group" open>
                        <summary><span>Style des Titres de Section</span><label class="completion-label"><input type="checkbox" id="completion-styles-titles" class="completion-checkbox"><span>Fait ✅</span></label></summary>
                        <div class="control-group-content">
                            <div class="grid grid-cols-2 gap-2">
                                <button data-title-style="style-underline" class="section-title-style-btn bg-gray-200 p-2 rounded-md text-sm active" title="Titre avec soulignement">Souligné</button>
                                <button data-title-style="style-side-line" class="section-title-style-btn bg-gray-200 p-2 rounded-md text-sm" title="Titre avec ligne latérale">Ligne Côté</button>
                                <button data-title-style="style-background" class="section-title-style-btn bg-gray-200 p-2 rounded-md text-sm" title="Titre avec fond coloré">Fond</button>
                                <button data-title-style="style-boxed" class="section-title-style-btn bg-gray-200 p-2 rounded-md text-sm" title="Titre dans une boîte">Encadré</button>
                            </div>
                        </div>
                    </details>
                </div>

                <!-- TAB: Bannière -->
                <div id="panel-banner" class="tab-panel hidden space-y-4">
                     <details class="control-group" open>
                        <summary><span>Bannière Recruteur</span><label class="completion-label"><input type="checkbox" id="completion-banner-main" class="completion-checkbox"><span>Fait ✅</span></label></summary>
                        <div class="control-group-content space-y-3">
                            <div class="flex justify-between items-center">
                                <h3 class="font-semibold text-gray-700">Bannière Recruteur</h3>
                                <button id="reset-recruiter-btn" class="text-sm text-gray-500 hover:text-red-600" title="Réinitialiser les informations recruteur"><i class="fas fa-undo"></i></button>
                            </div>
                            <div id="banner-fix-controls"><button id="fix-banner-top-btn" class="w-full bg-teal-600 text-white py-2 px-4 rounded-md hover:bg-teal-700 flex items-center justify-center gap-2" title="Fixer la bannière en haut de la page"><i class="fas fa-arrow-up"></i>Fixer en haut</button><button id="fix-banner-bottom-btn" class="w-full bg-teal-600 text-white py-2 px-4 rounded-md hover:bg-teal-700 flex items-center justify-center gap-2 mt-2" title="Fixer la bannière en bas de la page"><i class="fas fa-arrow-down"></i>Fixer en bas</button></div><button id="modular-banner-btn" class="cv-input w-full bg-orange-500 text-white py-2 px-4 rounded-md hover:bg-orange-600 flex items-center justify-center gap-2 hidden" title="Rendre la bannière modulable et repositionnable"><i class="fas fa-arrows-up-down-left-right"></i>Rendre modulaire</button><label class="flex items-center gap-2 text-sm"><input type="checkbox" id="toggle-banner-checkbox" class="cv-input">Afficher la bannière</label><label for="banner-style-select" class="text-sm font-medium">Style de Bannière</label><select id="banner-style-select" class="cv-input w-full p-2 border rounded-md"><option value="banner-style-modern">Moderne</option><option value="banner-style-elegant">Élégant</option><option value="banner-style-discret">Discret</option><option value="banner-style-carte">Carte</option><option value="banner-style-degrade">Dégradé</option><option value="banner-style-premium">Premium</option><option value="banner-style-minimal">Minimal</option><option value="banner-style-encadre">Encadré</option><option value="banner-style-ligne-haute">Ligne Haute</option></select><p class="text-sm font-medium">Alignement</p><div class="flex gap-2"><button data-banner-align="left" class="banner-align-btn flex-1 bg-gray-200 p-2 rounded-md text-sm" title="Aligner la bannière à gauche"><i class="fas fa-align-left"></i></button><button data-banner-align="center" class="banner-align-btn flex-1 bg-gray-200 p-2 rounded-md text-sm" title="Centrer la bannière"><i class="fas fa-align-center"></i></button><button data-banner-align="right" class="banner-align-btn flex-1 bg-gray-200 p-2 rounded-md text-sm" title="Aligner la bannière à droite"><i class="fas fa-align-right"></i></button><button id="banner-invert-btn" class="p-2 bg-gray-200 rounded-md text-sm" title="Inverser Logo/Texte"><i class="fas fa-right-left"></i></button></div><p class="text-sm font-medium">Taille Logo</p><div class="flex gap-2"><button data-logo-size="sm" class="logo-size-btn flex-1 bg-gray-200 p-2 rounded-md text-sm" title="Petit logo">P</button><button data-logo-size="md" class="logo-size-btn flex-1 bg-gray-200 p-2 rounded-md text-sm" title="Moyen logo">M</button><button data-logo-size="lg" class="logo-size-btn flex-1 bg-gray-200 p-2 rounded-md text-sm" title="Grand logo">G</button><button data-logo-size="xl" class="logo-size-btn flex-1 bg-gray-200 p-2 rounded-md text-sm" title="Très grand logo">XL</button><button data-logo-size="xxl" class="logo-size-btn flex-1 bg-gray-200 p-2 rounded-md text-sm" title="Extra grand logo">XXL</button></div><div><label for="banner-element-spacing" class="block text-sm font-medium text-gray-700">Espace Bannière: <span id="banner-element-spacing-value">1</span>rem</label><input type="range" id="banner-element-spacing" min="0.5" max="4" step="0.1" value="1" class="cv-input w-full h-2 bg-gray-200 rounded-lg cursor-pointer"></div><input type="text" id="banner-nom" placeholder="Votre Nom & Prénom" class="banner-input w-full p-2 border rounded-md"><input type="text" id="banner-poste" placeholder="Votre Poste" class="banner-input w-full p-2 border rounded-md"><input type="email" id="banner-email" placeholder="Email" class="banner-input w-full p-2 border rounded-md"><input type="tel" id="banner-tel" placeholder="Téléphone" class="banner-input w-full p-2 border rounded-md"><div><label for="banner-image" class="block text-sm font-medium text-gray-700">Photo/Logo</label><input type="file" id="banner-image" accept="image/*" class="banner-input mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"></div>
                        </div>
                    </details>
                     <details class="control-group" open>
                        <summary><span>Image de Fond</span><label class="completion-label"><input type="checkbox" id="completion-banner-bg" class="completion-checkbox"><span>Fait ✅</span></label></summary>
                        <div class="control-group-content space-y-4">
                            <div>
                                <label for="banner-bg-image" class="block text-sm font-medium text-gray-700">Télécharger une image</label>
                                <input type="file" id="banner-bg-image" accept="image/*" class="banner-input mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100">
                            </div>
                            <div>
                                <label for="banner-bg-opacity" class="block text-sm font-medium text-gray-700">Opacité: <span id="banner-bg-opacity-value">1</span></label>
                                <input type="range" id="banner-bg-opacity" min="0" max="1" step="0.05" value="1" class="cv-input w-full h-2 bg-gray-200 rounded-lg cursor-pointer">
                            </div>
                            <div>
                                <label for="banner-bg-blur" class="block text-sm font-medium text-gray-700">Flou: <span id="banner-bg-blur-value">0</span>px</label>
                                <input type="range" id="banner-bg-blur" min="0" max="20" step="1" value="0" class="cv-input w-full h-2 bg-gray-200 rounded-lg cursor-pointer">
                            </div>
                            <label class="flex items-center gap-2 text-sm"><input type="checkbox" id="banner-bg-grayscale" class="cv-input">Image en noir et blanc</label>
                            <button id="remove-banner-bg-btn" class="w-full bg-red-500 text-white py-2 px-4 rounded-md hover:bg-red-600 flex items-center justify-center gap-2"><i class="fas fa-trash"></i> Supprimer l'image de fond</button>
                            <div class="flex gap-2 mt-4">
                                <button id="save-banner-settings-btn" class="flex-1 bg-green-500 text-white py-2 px-4 rounded-md hover:bg-green-600 flex items-center justify-center gap-2"><i class="fas fa-save"></i> Sauvegarder Bannière</button>
                                <button id="load-banner-settings-btn" class="flex-1 bg-blue-500 text-white py-2 px-4 rounded-md hover:bg-blue-600 flex items-center justify-center gap-2"><i class="fas fa-folder-open"></i> Charger Bannière</button>
                            </div>
                        </div>
                    </details>
                     <details class="control-group" open>
                        <summary><span>Style du Texte</span><label class="completion-label"><input type="checkbox" id="completion-banner-text" class="completion-checkbox"><span>Fait ✅</span></label></summary>
                        <div class="control-group-content space-y-4">
                            <button id="randomize-banner-style-btn" class="w-full bg-indigo-500 text-white py-2 px-4 rounded-md hover:bg-indigo-600 flex items-center justify-center gap-2"><i class="fas fa-dice"></i> Style Aléatoire</button><div class="border-t pt-4 mt-4"><h4 class="font-semibold text-sm mb-2">Nom & Prénom</h4><label class="text-xs">Police</label><select id="banner-nom-font" class="cv-input w-full p-1 border text-sm rounded-md"><option value="'Montserrat', sans-serif">Montserrat</option><option value="'Playfair Display', serif">Playfair Display</option><option value="'Oswald', sans-serif">Oswald</option><option value="'Cormorant Garamond', serif">Cormorant Garamond</option><option value="'Merriweather', serif">Merriweather</option><option value="'Lato', sans-serif">Lato</option></select><label class="text-xs mt-2 block">Taille: <span id="banner-nom-size-value">24</span>pt</label><input type="range" id="banner-nom-size" min="14" max="40" step="1" value="24" class="cv-input w-full h-2 bg-gray-200 rounded-lg cursor-pointer"><div class="flex items-center gap-2 mt-2"><label class="text-xs">Couleur:</label><input type="color" id="banner-nom-color" value="#334155" class="cv-input w-full h-8 p-1 border rounded-md"><button id="banner-nom-bold" class="style-toggle-btn p-1 px-2 rounded-md bg-gray-200 text-sm"><i class="fas fa-bold"></i></button><button id="banner-nom-italic" class="style-toggle-btn p-1 px-2 rounded-md bg-gray-200 text-sm"><i class="fas fa-italic"></i></button></div></div><div class="border-t pt-4 mt-4"><h4 class="font-semibold text-sm mb-2">Poste</h4><label class="text-xs mt-2 block">Taille: <span id="banner-poste-size-value">12</span>pt</label><input type="range" id="banner-poste-size" min="8" max="20" step="0.5" value="12" class="cv-input w-full h-2 bg-gray-200 rounded-lg cursor-pointer"><div class="flex items-center gap-2 mt-2"><label class="text-xs">Couleur:</label><input type="color" id="banner-poste-color" value="#334155" class="cv-input w-full h-8 p-1 border rounded-md"><button id="banner-poste-bold" class="style-toggle-btn p-1 px-2 rounded-md bg-gray-200 text-sm"><i class="fas fa-bold"></i></button><button id="banner-poste-italic" class="style-toggle-btn p-1 px-2 rounded-md bg-gray-200 text-sm"><i class="fas fa-italic"></i></button></div></div><div class="border-t pt-4 mt-4"><h4 class="font-semibold text-sm mb-2">Coordonnées</h4><label class="text-xs mt-2 block">Taille: <span id="banner-contact-size-value">9</span>pt</label><input type="range" id="banner-contact-size" min="7" max="14" step="0.5" value="9" class="cv-input w-full h-2 bg-gray-200 rounded-lg cursor-pointer"><div class="flex items-center gap-2 mt-2"><label class="text-xs">Couleur:</label><input type="color" id="banner-contact-color" value="#334155" class="cv-input w-full h-8 p-1 border rounded-md"><button id="banner-contact-bold" class="style-toggle-btn p-1 px-2 rounded-md bg-gray-200 text-sm"><i class="fas fa-bold"></i></button><button id="banner-contact-italic" class="style-toggle-btn p-1 px-2 rounded-md bg-gray-200 text-sm"><i class="fas fa-italic"></i></button></div></div>
                        </div>
                    </details>
                </div>
            </div>

        </div>

        <!-- PREVIEW PANEL -->
        <div class="w-full lg:w-2/3 xl:w-3/4 p-8 bg-gray-200 flex justify-center items-start overflow-auto" id="main-content">
            <div id="cv-preview-wrapper">
                <div class="a4-page-container">
                    <div id="page-1" class="a4-page">
                        <div id="fixed-banner-top"></div>
                        <div class="cv-body-container layout-1-col">
                            <div id="cv-col-1-1" class="cv-column">
                                <div id="banner-module" class="cv-module">
                                    <div class="drag-handle"><i class="fas fa-grip-vertical"></i></div>
                                    <div id="recruiter-banner" class="banner-align-left">
                                        <img id="banner-bg-img-preview" src="" alt="Banner background" class="absolute top-0 left-0 w-full h-full object-cover z-0 transition-all duration-300">
                                        <div class="banner-content-wrapper">
                                            <img id="banner-img-preview" class="logo-md" src="https://placehold.co/100x100/EFEFEF/AAAAAA&text=Photo" alt="Photo recruteur" onerror="this.onerror=null; this.src='https://placehold.co/100x100/EFEFEF/AAAAAA&text=Photo';">
                                            <div class="banner-content">
                                                <p id="banner-nom-preview" class="item-title" contenteditable="true"></p>
                                                <p id="banner-poste-preview" contenteditable="true"></p>
                                                <p id="banner-contact-preview"><span id="banner-email-preview" contenteditable="true"></span> | <span id="banner-tel-preview" contenteditable="true"></span></p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div id="header-module" class="cv-module"><div class="drag-handle"><i class="fas fa-grip-vertical"></i></div><div class="cv-header text-center"><div class="editable-wrapper"><h1 id="cv-nom-prenom-preview" contenteditable="true">Prénom NOM</h1><span class="delete-line-btn"><i class="fas fa-times"></i></span></div><div class="editable-wrapper"><p id="cv-poste-preview" contenteditable="true">Poste Recherché</p><span class="delete-line-btn"><i class="fas fa-times"></i></span></div></div></div>
                                <div id="qualification-module" class="cv-module"><div class="drag-handle"><i class="fas fa-grip-vertical"></i></div><div id="qualification-preview" class="flex justify-center gap-4 text-center text-sm p-2 bg-slate-50 rounded-md"></div></div>
                                <div id="description-module" class="cv-module"><div class="drag-handle"><i class="fas fa-grip-vertical"></i></div><h2 class="section-title style-underline" data-section-id="description"><i class="fas fa-user-circle section-icon"></i><span contenteditable="true">Profil</span><div class="section-ai-actions"><button class="ai-action-btn toggle-visibility-btn" title="Masquer/Afficher la section"><i class="fas fa-eye"></i></button><button class="ai-action-btn" data-action="rewrite-profile" title="Réécrire le profil avec l'IA"><i class="fas fa-magic-wand-sparkles"></i></button></div></h2><div id="cv-description-preview"></div></div>
                                <div id="experience-module" class="cv-module"><div class="drag-handle"><i class="fas fa-grip-vertical"></i></div><h2 class="section-title style-underline" data-section-id="experience"><i class="fas fa-briefcase section-icon"></i><span contenteditable="true">Expérience</span><div class="section-ai-actions"><button class="ai-action-btn toggle-visibility-btn" title="Masquer/Afficher la section"><i class="fas fa-eye"></i></button><button class="ai-action-btn" data-action="summarize-experience" title="Synthétiser les expériences avec l'IA (5 lignes max)"><i class="fas fa-magic-wand-sparkles"></i></button></div></h2><div id="cv-experience-preview"></div></div>
                                <div id="formation-module" class="cv-module"><div class="drag-handle"><i class="fas fa-grip-vertical"></i></div><h2 class="section-title style-underline" data-section-id="formation"><i class="fas fa-graduation-cap section-icon"></i><span contenteditable="true">Formation</span><div class="section-ai-actions"><button class="ai-action-btn toggle-visibility-btn" title="Masquer/Afficher la section"><i class="fas fa-eye"></i></button><button class="ai-action-btn" data-action="rewrite-formation" title="Améliorer les formations avec l'IA"><i class="fas fa-magic-wand-sparkles"></i></button></div></h2><div id="cv-formation-preview"></div></div>
                                <div id="competences-module" class="cv-module"><div class="drag-handle"><i class="fas fa-grip-vertical"></i></div><h2 class="section-title style-underline" data-section-id="competences"><i class="fas fa-star section-icon"></i><span contenteditable="true">Compétences</span><div class="section-ai-actions"><button class="ai-action-btn toggle-visibility-btn" title="Masquer/Afficher la section"><i class="fas fa-eye"></i></button></div></h2><div id="cv-competences-preview"></div></div>
                                <div id="interests-module" class="cv-module"><div class="drag-handle"><i class="fas fa-grip-vertical"></i></div><h2 class="section-title style-underline" data-section-id="interests"><i class="fas fa-heart section-icon"></i><span contenteditable="true">Centres d'Intérêt</span><div class="section-ai-actions"><button class="ai-action-btn toggle-visibility-btn" title="Masquer/Afficher la section"><i class="fas fa-eye"></i></button></div></h2><div id="cv-interests-preview"></div></div>
                            </div>
                        </div>
                        <div id="fixed-banner-bottom"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="notification" class="fixed top-4 right-4 z-50"></div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Application CV chargée');
            
            const controls = {
                nom: document.getElementById('nom'),
                prenom: document.getElementById('prenom'),
                poste: document.getElementById('poste'),
                email: document.getElementById('email'),
                telephone: document.getElementById('telephone'),
                description: document.getElementById('description'),
                competences: document.getElementById('competences'),
                interests: document.getElementById('interests'),
                loader: document.getElementById('loader-overlay'),
                loaderText: document.getElementById('loader-text'),
                aiSuggestInterestsBtn: document.getElementById('ai-suggest-interests-btn'),
                interestsCount: document.getElementById('interests-count'),
                analyzeBtn: document.getElementById('analyze-btn'),
                experienceList: document.getElementById('experience-list'),
                formationList: document.getElementById('formation-list'),
                addExperienceBtn: document.getElementById('add-experience'),
                addFormationBtn: document.getElementById('add-formation'),
                downloadPdfBtn: document.getElementById('download-pdf-btn'),
                resetCvBtn: document.getElementById('reset-cv-btn'),
                bannerNom: document.getElementById('banner-nom'),
                bannerPoste: document.getElementById('banner-poste'),
                bannerEmail: document.getElementById('banner-email'),
                bannerTel: document.getElementById('banner-tel'),
                bannerImage: document.getElementById('banner-image'),
                cvNomPrenomPreview: document.getElementById('cv-nom-prenom-preview'),
                cvPostePreview: document.getElementById('cv-poste-preview'),
                cvDescriptionPreview: document.getElementById('cv-description-preview'),
                cvExperiencePreview: document.getElementById('cv-experience-preview'),
                cvFormationPreview: document.getElementById('cv-formation-preview'),
                cvCompetencesPreview: document.getElementById('cv-competences-preview'),
                cvInterestsPreview: document.getElementById('cv-interests-preview'),
                bannerNomPreview: document.getElementById('banner-nom-preview'),
                bannerPostePreview: document.getElementById('banner-poste-preview'),
                bannerEmailPreview: document.getElementById('banner-email-preview'),
                bannerTelPreview: document.getElementById('banner-tel-preview')
            };

            function showLoader(text = "Chargement...") {
                if (controls.loaderText) controls.loaderText.textContent = text;
                if (controls.loader) {
                    controls.loader.classList.remove('hidden');
                    controls.loader.classList.add('flex');
                }
            }

            function hideLoader() {
                if (controls.loader) {
                    controls.loader.classList.add('hidden');
                    controls.loader.classList.remove('flex');
                }
            }

            function showNotification(message, type = 'success', duration = 3000) {
                const container = document.getElementById('notification');
                if (!container) return;
                
                const toast = document.createElement('div');
                toast.className = `p-4 rounded-md shadow-lg text-white max-w-sm mb-2 transition-all duration-300 transform translate-x-full opacity-0 ${
                    type === 'error' ? 'bg-red-500' : 
                    type === 'warning' ? 'bg-yellow-500' : 
                    'bg-green-500'
                }`;
                
                const icon = type === 'error' ? 'fa-times-circle' : 
                           type === 'warning' ? 'fa-exclamation-triangle' : 
                           'fa-check-circle';
                           
                toast.innerHTML = `
                    <div class="flex items-center gap-2">
                        <i class="fas ${icon}"></i>
                        <span>${message}</span>
                    </div>
                `;
                
                container.appendChild(toast);
                setTimeout(() => {
                    toast.style.opacity = '1';
                    toast.style.transform = 'translateX(0)';
                }, 10);
                setTimeout(() => {
                    toast.style.opacity = '0';
                    toast.style.transform = 'translateX(100%)';
                    setTimeout(() => toast.remove(), 300);
                }, duration);
            }

            function createDynamicItem(container, fields, data = {}, index = -1) {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'p-2 border rounded-md bg-white relative';
                
                fields.forEach(field => {
                    const isTextarea = field.type === 'textarea';
                    const input = document.createElement(isTextarea ? 'textarea' : 'input');
                    
                    if (!isTextarea) input.type = 'text';
                    
                    input.placeholder = field.placeholder;
                    input.className = `cv-input w-full p-1 border rounded-sm mb-1 data-${field.key}`;
                    if(isTextarea) input.rows = 3;
                    input.value = data[field.key] || '';
                    itemDiv.appendChild(input);
                });

                const removeBtn = document.createElement('button');
                removeBtn.innerHTML = '<i class="fas fa-times-circle text-red-400 hover:text-red-600"></i>';
                removeBtn.className = 'absolute top-1 right-1 remove-dynamic-item-btn';
                itemDiv.appendChild(removeBtn);
                
                if (index !== -1 && index < container.children.length) {
                    container.insertBefore(itemDiv, container.children[index]);
                } else {
                    container.appendChild(itemDiv);
                }
                
                updatePreview('form');
                const firstInput = itemDiv.querySelector('input, textarea');
                if (firstInput) firstInput.focus();
            }

            function updatePreview(source = 'form') {
                // Simple preview update - can be enhanced later
                console.log('Preview updated from:', source);
            }

            // API Settings functionality
            let apiSettings = {
                provider: 'gemini',
                gemini: { apiKey: '', isValid: false },
                chatgpt: { apiKey: '', model: 'gpt-3.5-turbo', isValid: false }
            };

            // Load API settings from localStorage
            function loadApiSettings() {
                const saved = localStorage.getItem('cv-api-settings');
                if (saved) {
                    apiSettings = { ...apiSettings, ...JSON.parse(saved) };
                }
            }

            async function callGeminiAPI(prompt, schema) {
                // Vérifier si une clé API Gemini est disponible
                if (!apiSettings.gemini.apiKey) {
                    showNotification("Veuillez configurer votre clé API Gemini dans les paramètres.", 'error');
                    return null;
                }

                showLoader("L'IA réfléchit...");
                try {
                    const apiKey = apiSettings.gemini.apiKey;
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                    const payload = {
                        contents: [{ role: "user", parts: [{ text: prompt }] }],
                        generationConfig: schema ? { responseMimeType: "application/json", responseSchema: schema } : {}
                    };

                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        const errorBody = await response.text();
                        throw new Error(`Erreur API: ${response.status} ${response.statusText} - ${errorBody}`);
                    }

                    const result = await response.json();

                    if (result.candidates && result.candidates.length > 0) {
                         if (result.candidates[0].finishReason !== "STOP" && result.candidates[0].finishReason !== "MAX_TOKENS") {
                               throw new Error(`L'IA a été bloquée (raison: ${result.candidates[0].finishReason}). Veuillez reformuler votre demande.`);
                         }
                        if (result.candidates[0].content && result.candidates[0].content.parts && result.candidates[0].content.parts.length > 0) {
                            const text = result.candidates[0].content.parts[0].text;
                            return schema ? JSON.parse(text) : text;
                        }
                    }

                    throw new Error("Réponse invalide ou vide reçue de l'IA.");

                } catch (error) {
                    console.error("Erreur détaillée de l'IA:", error);
                    showNotification(`Erreur de l'IA : ${error.message}`, 'error', 5000);
                    return null;
                } finally {
                    hideLoader();
                }
            }

            async function callChatGPTAPI(prompt) {
                // Vérifier si une clé API ChatGPT est disponible
                if (!apiSettings.chatgpt.apiKey) {
                    showNotification("Veuillez configurer votre clé API ChatGPT dans les paramètres.", 'error');
                    return null;
                }

                showLoader("L'IA réfléchit...");
                try {
                    const apiKey = apiSettings.chatgpt.apiKey;
                    const apiUrl = 'https://api.openai.com/v1/chat/completions';

                    const payload = {
                        model: apiSettings.chatgpt.model || 'gpt-3.5-turbo',
                        messages: [{ role: 'user', content: prompt }],
                        max_tokens: 1000,
                        temperature: 0.7
                    };

                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${apiKey}`
                        },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        const errorBody = await response.json();
                        throw new Error(`Erreur API ChatGPT: ${errorBody.error?.message || response.statusText}`);
                    }

                    const result = await response.json();

                    if (result.choices && result.choices.length > 0) {
                        return result.choices[0].message.content;
                    }

                    throw new Error("Réponse invalide ou vide reçue de ChatGPT.");

                } catch (error) {
                    console.error("Erreur détaillée de ChatGPT:", error);
                    showNotification(`Erreur ChatGPT : ${error.message}`, 'error', 5000);
                    return null;
                } finally {
                    hideLoader();
                }
            }

            async function callAIAPI(prompt, schema = null) {
                // Vérifier qu'un fournisseur est sélectionné
                if (!apiSettings.provider) {
                    showNotification("Veuillez sélectionner un fournisseur d'IA dans les paramètres.", 'error');
                    return null;
                }

                // Vérifier que la clé API est disponible
                const hasApiKey = (apiSettings.provider === 'gemini' && apiSettings.gemini.apiKey) ||
                                 (apiSettings.provider === 'chatgpt' && apiSettings.chatgpt.apiKey);

                if (!hasApiKey) {
                    showNotification(`Veuillez configurer votre clé API ${apiSettings.provider} dans les paramètres.`, 'error');
                    return null;
                }

                // Router vers la bonne API
                if (apiSettings.provider === 'gemini') {
                    return await callGeminiAPI(prompt, schema);
                } else if (apiSettings.provider === 'chatgpt') {
                    return await callChatGPTAPI(prompt);
                } else {
                    showNotification("Fournisseur d'IA non supporté.", 'error');
                    return null;
                }
            }

            if (controls.interests && controls.interestsCount) {
                controls.interests.addEventListener('input', () => {
                    const interests = controls.interests.value.split(',').filter(i => i.trim());
                    controls.interestsCount.textContent = interests.length;
                });
            }

            // Event listeners for add buttons
            if (controls.addExperienceBtn) {
                controls.addExperienceBtn.addEventListener('click', () => createDynamicItem(controls.experienceList, [
                    { key: 'title', placeholder: 'Titre du poste' },
                    { key: 'meta', placeholder: 'Entreprise & Dates' },
                    { key: 'desc', placeholder: 'Description des missions', type: 'textarea' }
                ]));
            }

            if (controls.addFormationBtn) {
                controls.addFormationBtn.addEventListener('click', () => createDynamicItem(controls.formationList, [
                    { key: 'title', placeholder: 'Nom du diplôme' },
                    { key: 'meta', placeholder: 'Établissement & Année' }
                ]));
            }

            // Event listeners for other essential buttons
            if (controls.analyzeBtn) {
                controls.analyzeBtn.addEventListener('click', async () => {
                    const aiInput = document.getElementById('ai-input');
                    if (!aiInput || !aiInput.value.trim()) {
                        showNotification('Veuillez saisir un texte à analyser.', 'warning');
                        return;
                    }
                    
                    try {
                        showLoader('Analyse du texte...');
                        const result = await callAIAPI(`Analyse ce texte et extrais les informations pour remplir un CV. Retourne un objet JSON avec les champs: nom, prenom, poste, description, email, telephone, competences, experiences, formations. Texte: "${aiInput.value}"`);
                        
                        if (result && typeof result === 'object') {
                            if (result.nom) controls.nom.value = result.nom;
                            if (result.prenom) controls.prenom.value = result.prenom;
                            if (result.poste) controls.poste.value = result.poste;
                            if (result.description) controls.description.value = result.description;
                            if (result.email) controls.email.value = result.email;
                            if (result.telephone) controls.telephone.value = result.telephone;
                            if (result.competences) controls.competences.value = result.competences;
                            
                            updatePreview('form');
                            showNotification('Texte analysé et champs remplis.', 'success');
                        }
                    } catch (error) {
                        console.error('Erreur lors de l\'analyse:', error);
                        showNotification('Erreur lors de l\'analyse du texte.', 'error');
                    } finally {
                        hideLoader();
                    }
                });
            }

            if (controls.downloadPdfBtn) {
                controls.downloadPdfBtn.addEventListener('click', async () => {
                    try {
                        showLoader('Génération du PDF...');
                        const element = document.getElementById('cv-preview-wrapper');
                        if (!element) {
                            showNotification('Aperçu CV non trouvé.', 'error');
                            return;
                        }
                        
                        const opt = {
                            margin: 1,
                            filename: 'cv.pdf',
                            image: { type: 'jpeg', quality: 0.98 },
                            html2canvas: { scale: 2 },
                            jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' }
                        };
                        
                        await html2pdf().set(opt).from(element).save();
                        showNotification('PDF généré avec succès !', 'success');
                    } catch (error) {
                        console.error('Erreur lors de la génération du PDF:', error);
                        showNotification('Erreur lors de la génération du PDF.', 'error');
                    } finally {
                        hideLoader();
                    }
                });
            }

            if (controls.resetCvBtn) {
                controls.resetCvBtn.addEventListener('click', () => {
                    if (confirm('Êtes-vous sûr de vouloir réinitialiser le CV ? Toutes les données seront perdues.')) {
                        // Reset all form fields
                        document.querySelectorAll('.cv-input').forEach(input => {
                            if (input.type === 'checkbox') input.checked = false;
                            else input.value = '';
                        });
                        
                        // Clear dynamic lists
                        if (controls.experienceList) controls.experienceList.innerHTML = '';
                        if (controls.formationList) controls.formationList.innerHTML = '';
                        
                        updatePreview('form');
                        showNotification('CV réinitialisé.', 'success');
                    }
                });
            }

            if (controls.aiSuggestInterestsBtn) {
                controls.aiSuggestInterestsBtn.addEventListener('click', async () => {
                    const currentInterests = controls.interests ? controls.interests.value : '';
                    const poste = controls.poste ? controls.poste.value : 'général';
                    
                    const prompt = `En tant qu'expert en recrutement, suggère 8 centres d'intérêt pertinents pour un CV dans le domaine professionnel de "${poste}". Tiens compte des centres d'intérêt existants: "${currentInterests}". Retourne uniquement la liste des suggestions séparées par des virgules, sans introduction ni conclusion.`;

                    try {
                        showLoader("Génération de suggestions...");
                        const suggestions = await callAIAPI(prompt);
                        
                        if (suggestions && controls.interests) {
                            if (currentInterests) {
                                controls.interests.value = currentInterests + ', ' + suggestions;
                            } else {
                                controls.interests.value = suggestions;
                            }
                            
                            const interests = controls.interests.value.split(',').filter(i => i.trim());
                            if (controls.interestsCount) {
                                controls.interestsCount.textContent = interests.length;
                            }
                            
                            showNotification('Suggestions IA ajoutées à vos centres d\'intérêt.', 'success');
                        }
                    } catch (error) {
                        console.error('Erreur API IA:', error);
                        showNotification('Erreur lors de la génération de suggestions.', 'error');
                    } finally {
                        hideLoader();
                    }
                });
            }

            // Event delegation for remove buttons
            const controlsPanel = document.getElementById('controls');
            if (controlsPanel) {
                controlsPanel.addEventListener('click', (e) => {
                    const target = e.target;
                    
                    const removeBtn = target.closest('.remove-dynamic-item-btn');
                    if (removeBtn) {
                        removeBtn.parentElement.remove();
                        updatePreview('form');
                        return;
                    }
                });
            }

            function syncPreview() {
                if (controls.nom && controls.prenom && controls.cvNomPrenomPreview) {
                    const nomComplet = `${controls.prenom.value} ${controls.nom.value}`.trim();
                    controls.cvNomPrenomPreview.textContent = nomComplet || 'Prénom NOM';
                }
                
                if (controls.poste && controls.cvPostePreview) {
                    controls.cvPostePreview.textContent = controls.poste.value || 'Poste Recherché';
                }
                
                if (controls.description && controls.cvDescriptionPreview) {
                    controls.cvDescriptionPreview.innerHTML = controls.description.value.replace(/\n/g, '<br>') || '';
                }
                
                if (controls.competences && controls.cvCompetencesPreview) {
                    const competences = controls.competences.value.split(',').filter(c => c.trim());
                    controls.cvCompetencesPreview.innerHTML = competences.map(c => `<span class="skill-tag">${c.trim()}</span>`).join(' ');
                }
                
                if (controls.interests && controls.cvInterestsPreview) {
                    const interests = controls.interests.value.split(',').filter(i => i.trim());
                    controls.cvInterestsPreview.innerHTML = interests.map(i => `<span class="interest-tag">${i.trim()}</span>`).join(' ');
                }
                
                if (controls.bannerNom && controls.bannerNomPreview) {
                    controls.bannerNomPreview.textContent = controls.bannerNom.value || '';
                }
                if (controls.bannerPoste && controls.bannerPostePreview) {
                    controls.bannerPostePreview.textContent = controls.bannerPoste.value || '';
                }
                if (controls.bannerEmail && controls.bannerEmailPreview) {
                    controls.bannerEmailPreview.textContent = controls.bannerEmail.value || '';
                }
                if (controls.bannerTel && controls.bannerTelPreview) {
                    controls.bannerTelPreview.textContent = controls.bannerTel.value || '';
                }
            }

            const fieldsToWatch = ['nom', 'prenom', 'poste', 'description', 'competences', 'interests', 'bannerNom', 'bannerPoste', 'bannerEmail', 'bannerTel'];
            fieldsToWatch.forEach(fieldName => {
                if (controls[fieldName]) {
                    controls[fieldName].addEventListener('input', syncPreview);
                }
            });

            syncPreview();
            loadApiSettings();
            console.log('Tous les gestionnaires d\'événements sont configurés');
        });
    </script>
</body>
</html>